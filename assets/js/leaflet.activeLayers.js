// Generated by CoffeeScript 1.7.1

/**
Created: vogdb Date: 5/4/13 Time: 1:54 PM
 */

(function() {

  L.Control.ActiveLayers = L.control["switch"].extend({
    /**
    Get currently active base layer on the map
    @return {Object} l where l.name - layer name on the control,
    l.layer is L.TileLayer, l.overlay is overlay layer.
    */

    getActiveBaseLayer: function() {
      return this._activeBaseLayer = this._findActiveBaseLayer();
    },
    /**
    Get currently active overlay layers on the map
    @return {{layerId: l}} where layerId is <code>L.stamp(l.layer)</code>
    and l @see #getActiveBaseLayer jsdoc.
    */

    getActiveOverlayLayers: function() {
      return this._activeOverlayLayers = this._findActiveOverlayLayers();
    },
    _findActiveBaseLayer: function() {
      var layer, layerId, layers;
      layers = this._layers;
      for (layerId in layers) {
        if (this._layers.hasOwnProperty(layerId)) {
          layer = layers[layerId];
          if (!layer.overlayer && this._map.hasLayer(layer.layer)) {
            return layer;
          }
        }
      }
      throw new Error("Control doesn't have any active base layer!");
    },
    _findActiveOverlayLayers: function() {
      var layer, layerId, layers, result;
      result = {};
      layers = this._layers;
      for (layerId in layers) {
        if (this._layers.hasOwnProperty(layerId)) {
          layer = layers[layerId];
          if (layer.overlayer && this._map.hasLayer(layer.layer)) {
            result[layerId] = layer;
          }
        }
      }
      return result;
    }
  });

  L.control.activeLayers = function(baseLayers, overlays, options) {
    return new L.Control.ActiveLayers(baseLayers, overlays, options);
  };

}).call(this);
