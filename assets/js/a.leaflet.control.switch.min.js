(function(){L.control["switch"]=L.Control.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,overlayControl:!1},initialize:function(a,b,c){var d=this;L.setOptions(this,c);this._layers={};this._lastZIndex=0;this._handlingClick=!1;$.each(a,function(a,b){return d._addLayer(b.layer,a,!1,!1)});return $.each(b,function(a,b){return d._addLayer(b.layer,a,!0,"boolean"===typeof b.overlayControl?b.overlayControl:!0)})},onAdd:function(a){this._initLayout();this._update();a.on("layeradd",this._onLayerChange,
this).on("layerremove",this._onLayerChange,this);return this._container},onRemove:function(a){return a.off("layeradd",this._onLayerChange).off("layerremove",this._onLayerChange)},addBaseLayer:function(a,b){this._addLayer(a,b);this._update();return this},addOverLayer:function(a,b,c){this._addLayer(a,b,!0,c);this._update();return this},removeLayer:function(a){a=L.stamp(a);delete this._layers[a];this._update();return this},_initLayout:function(){var a,b,c;a=this._container=L.DomUtil.create("div","leaflet-bar switch-control-layers");
a.setAttribute("aria-haspopup",!0);if(L.Browser.touch)L.DomEvent.on(a,"click",L.DomEvent.stopPropagation);else L.DomEvent.disableClickPropagation(a),L.DomEvent.on(a,"mousewheel",L.DomEvent.stopPropagation);b=this._form=L.DomUtil.create("form","switch-control-layers-list form-layer-list");if(this.options.collapsed){L.DomEvent.on(a,"mouseover",this._expand,this).on(a,"mouseout",this._collapse,this);c=this._layersLink=L.DomUtil.create("a","switch-control-layers-toggle",a);c.href="#";c.title="Layers";
if(L.Browser.touch)L.DomEvent.on(c,"click",L.DomEvent.stop).on(c,"click",this._expand,this);else L.DomEvent.on(c,"focus",this._expand,this);this._map.on("click",this._collapse,this)}else this._expand();this._baseLayersList=L.DomUtil.create("div","switch-control-layers-base",b);this._separator=L.DomUtil.create("div","switch-control-layers-separator",b);this._overlayersList=L.DomUtil.create("div","switch-control-layers-overlayers",b);return $(a).append(b)},_addLayer:function(a,b,c,d){var e;e=L.stamp(a);
this._layers[e]={layer:a,name:b,overlayer:c,overlayControl:d};if(this.options.autoZIndex&&a.setZIndex)return this._lastZIndex++,a.setZIndex(this._lastZIndex)},_update:function(){var a,b,c,d,e;if(this._container){this._baseLayersList.innerHTML="";this._overlayersList.innerHTML="";d=a=!1;e=[];for(b in this._layers)c=this._layers[b],this._addItem(c),d=d||c.overlayer,a=a||!c.overlayer,e.push(this._separator.style.display=d&&a?"":"none");return e}},_onLayerChange:function(a){var b;if(b=this._layers[L.stamp(a.layer)])if(this._handlingClick||
this._update(),a=b.overlayer?"layeradd"===a.type?"overlayeradd":"overlayerremove":"layeradd"===a.type?"baselayerchange":null)return this._map.fire(a,b)},_addItem:function(a){var b,c,d,e,f,g=this;d=L.DomUtil.create("div","control-group",a.overlayer?this._overlayersList:this._baseLayersList);b=this._map.hasLayer(a.layer);c=L.DomUtil.create("label","control-label",d);12>a.name.length&&!a.overlayControl||!a.overlayControl?21<a.name.length?(f=a.name.substr(0,21)+"\u2026",c.innerHTML='<abbr title="'+a.name+
'">'+f+"</abbr>"):c.innerHTML=a.name:(f=a.name.substr(0,12)+"\u2026",c.innerHTML='<abbr title="'+a.name+'">'+f+"</abbr>");c=L.DomUtil.create("div","control",d);f=L.DomUtil.create("div","switch-small",c);a.overlayer||$(f).addClass("baseLayers");e=L.DomUtil.create("input","",f);a.overlayControl?(e.type="checkbox",$(e).addClass("switch-control-layers-selector"),a.overlayControl&&(c=L.DomUtil.create("div","",d),$(c).addClass("switch-control-layers-slider"),$(c).slider({min:0,max:100,value:100,range:"min",
slide:function(b,c){return a.layer.eachLayer(function(a){return a.setOpacity?a.Opacity(c.value/100):a.setStyle({fillOpacity:c.value/100,opacity:c.value/100})})}}))):(e.type="radio",$(e).attr("name","leaflet-base-layers"));e.defaultChecked=b;e.layerId=L.stamp(a.layer);$(f).bootstrapSwitch();$(f).on("switch-change",function(b,c){a.overlayer||$(".baseLayers").bootstrapSwitch("toggleRadioState");return g._onInputClick(e,a)});return d},_onInputClick:function(a,b){this._handlingClick=!0;a.checked&&!this._map.hasLayer(b.layer)?
this._map.addLayer(b.layer):a.checked&&this._map.hasLayer(b.layer)||this._map.removeLayer(b.layer);return this._handlingClick=!1},_expand:function(){return L.DomUtil.addClass(this._form,"switch-control-layers-expanded")},_collapse:function(){return this._form.className=this._form.className.replace(" switch-control-layers-expanded","")}})}).call(this);
