// Generated by CoffeeScript 1.6.3
(function() {
  var chart1, chart2, chart3, chart4, chart5, chart6, chart7, chart8, chart9, i, knob1, knob2, knob3, rest, spark1, spark2, _i, _j, _ref, _ref1;

  H5.Data.state = "Todos";

  H5.Data.states = ["AC", "AM", "AP", "MA", "MT", "PA", "RO", "RR", "TO"];

  H5.Data.thisDate = new Date();

  H5.Data.thisYear = H5.Data.thisDate.getMonth() < 6 ? H5.Data.thisDate.getFullYear() : H5.Data.thisDate.getFullYear() + 1;

  H5.Data.thisMonth = new Date().getMonth();

  H5.Data.thisDay = new Date().getDate();

  H5.Data.totalPeriods = H5.Data.thisDate.getFullYear() - 2005;

  H5.Data.periods = new Array(H5.Data.totalPeriods);

  for (i = _i = 0, _ref = H5.Data.totalPeriods; 0 <= _ref ? _i <= _ref : _i >= _ref; i = 0 <= _ref ? ++_i : --_i) {
    H5.Data.periods[i] = (H5.Data.thisDate.getFullYear() - i - 1) + "-" + (H5.Data.thisDate.getFullYear() - i);
  }

  H5.Data.months = {
    0: "Ago",
    1: "Set",
    2: "Out",
    3: "Nov",
    4: "Dez",
    5: "Jan",
    6: "Fev",
    7: "Mar",
    8: "Abr",
    9: "Mai",
    10: "Jun",
    11: "Jul"
  };

  if (!H5.isMobile.any()) {
    H5.Data.animate = {
      duration: 500,
      easing: "inAndOut"
    };
  } else {
    H5.Data.animate = {};
  }

  H5.DB.diary.data = {
    init: function() {
      var state, _j, _len, _ref1, _results;
      this.states = {};
      _ref1 = H5.Data.states;
      _results = [];
      for (_j = 0, _len = _ref1.length; _j < _len; _j++) {
        state = _ref1[_j];
        _results.push(this.states[state] = {});
      }
      return _results;
    },
    populate: function(state, date, value) {
      var convertDate, self;
      convertDate = function(dateStr) {
        var dArr;
        dateStr = String(dateStr);
        dArr = dateStr.split("-");
        return new Date(dArr[0], dArr[1] - 1, dArr[2]);
      };
      self = this.states[state];
      self[date] = {};
      self[date].area = value;
      self[date].date = convertDate(date);
      self[date].year = convertDate(date).getFullYear();
      self[date].month = convertDate(date).getMonth();
      self[date].day = convertDate(date).getDate();
      if (this.lastValue) {
        if (this.lastValue.date < self[date].date) {
          this.lastValue = self[date];
        }
      } else {
        this.lastValue = self[date];
      }
    }
  };

  rest = new H5.Rest({
    url: "../painel/rest",
    table: H5.DB.diary.table
  });

  H5.DB.diary.data.init();

  $.each(rest.request(), function(i, properties) {
    return H5.DB.diary.data.populate(properties.estado, properties.data, parseFloat(properties.total));
  });

  H5.DB.prodes.data = {
    init: function() {
      var period, state, _j, _len, _ref1, _results;
      this.states = {};
      _ref1 = H5.Data.states;
      _results = [];
      for (_j = 0, _len = _ref1.length; _j < _len; _j++) {
        state = _ref1[_j];
        this.states[state] = {};
        _results.push((function() {
          var _k, _len1, _ref2, _results1;
          _ref2 = H5.Data.periods;
          _results1 = [];
          for (_k = 0, _len1 = _ref2.length; _k < _len1; _k++) {
            period = _ref2[_k];
            _results1.push(this.states[state][period] = {});
          }
          return _results1;
        }).call(this));
      }
      return _results;
    },
    populate: function(period, ac, am, ap, ma, mt, pa, ro, rr, to) {
      var self;
      self = this.states;
      self.AC[period].area = ac;
      self.AM[period].area = am;
      self.AP[period].area = ap;
      self.MA[period].area = ma;
      self.MT[period].area = mt;
      self.PA[period].area = pa;
      self.RO[period].area = ro;
      self.RR[period].area = rr;
      return self.TO[period].area = to;
    }
  };

  rest = new H5.Rest({
    url: "../painel/rest",
    table: H5.DB.prodes.table
  });

  H5.DB.prodes.data.init();

  $.each(rest.request(), function(i, properties) {
    return H5.DB.prodes.data.populate(properties.ano_prodes.replace('/', '-'), parseFloat(properties.ac), parseFloat(properties.am), parseFloat(properties.ap), parseFloat(properties.ma), parseFloat(properties.mt), parseFloat(properties.pa), parseFloat(properties.ro), parseFloat(properties.rr), parseFloat(properties.to));
  });

  H5.DB.cloud.data = {
    init: function() {
      return this.nuvem = {};
    },
    populate: function(date, value) {
      var convertDate, self;
      convertDate = function(dateStr) {
        var dArr;
        dateStr = String(dateStr);
        dArr = dateStr.split("-");
        return new Date(dArr[0], dArr[1] - 1, dArr[2]);
      };
      self = this.nuvem;
      self[date] = {};
      self[date].value = value;
      self[date].date = convertDate(date);
      self[date].year = convertDate(date).getFullYear();
      self[date].month = convertDate(date).getMonth();
      return self[date].day = convertDate(date).getDate();
    }
  };

  rest = new H5.Rest({
    url: "../painel/rest",
    table: H5.DB.cloud.table
  });

  H5.DB.cloud.data.init();

  $.each(rest.request(), function(i, properties) {
    return H5.DB.cloud.data.populate(properties.data, properties.percent);
  });

  H5.Data.thisDate = H5.DB.diary.data.lastValue.date;

  H5.Data.thisYear = H5.DB.diary.data.lastValue.month < 6 ? H5.DB.diary.data.lastValue.year : H5.DB.diary.data.lastValue.year + 1;

  H5.Data.thisMonth = H5.DB.diary.data.lastValue.month;

  H5.Data.thisDay = H5.DB.diary.data.lastValue.day;

  H5.Data.selectedYear = H5.Data.thisYear;

  H5.Data.selectedMonth = H5.Data.thisMonth;

  H5.Data.totalPeriods = H5.Data.thisDate.getFullYear() - 2005;

  H5.Data.periods = new Array(H5.Data.totalPeriods);

  for (i = _j = 0, _ref1 = H5.Data.totalPeriods; 0 <= _ref1 ? _j <= _ref1 : _j >= _ref1; i = 0 <= _ref1 ? ++_j : --_j) {
    H5.Data.periods[i] = (H5.Data.thisDate.getFullYear() - i - 1) + "-" + (H5.Data.thisDate.getFullYear() - i);
  }

  chart1 = new H5.Charts.GoogleCharts({
    type: "Line",
    container: "chart1",
    title: "Alerta DETER: Índice Diário",
    buttons: {
      "export": true,
      table: true,
      minimize: true,
      maximize: true
    }
  });

  chart1._yearsSlct = document.getElementById('yearsSlct');

  chart1._monthsSlct = document.getElementById('monthsSlct');

  chart1._yearsSlct.options[H5.Data.totalPeriods + 1].selected = true;

  chart1._monthsSlct.options[H5.Data.thisMonth].selected = true;

  $(chart1._monthsSlct).on("change", function(event) {
    H5.Data.selectedYear = chart1._yearsSlct.value;
    chart1.drawChart();
    chart3.drawChart();
    chart8.drawChart();
    knob1.drawChart();
    knob2.drawChart();
    knob3.drawChart();
    spark1.drawChart();
    return spark2.drawChart();
  });

  $(chart1._yearsSlct).on("change", function(event) {
    H5.Data.selectedMonth = chart1._monthsSlct.value;
    chart1.drawChart();
    chart3.drawChart();
    chart8.drawChart();
    knob1.drawChart();
    knob2.drawChart();
    knob3.drawChart();
    spark1.drawChart();
    spark2.drawChart();
    return H5.Charts.updateMap();
  });

  chart1.drawChart = function() {
    var createTable, data, day, daysInMonth, firstPeriod, months, options, secondPeriod, _k,
      _this = this;
    createTable = function(state) {
      var day, sum, _k, _results;
      sum = 0;
      _results = [];
      for (day = _k = 1; 1 <= daysInMonth ? _k <= daysInMonth : _k >= daysInMonth; day = 1 <= daysInMonth ? ++_k : --_k) {
        $.each(H5.DB.diary.data.states[state], function(key, reg) {
          var _ref2;
          if ((firstPeriod <= (_ref2 = reg.date) && _ref2 <= secondPeriod) && reg.day === day) {
            sum += reg.area;
            return false;
          }
        });
        _results.push(_this.data.setValue(day - 1, 1, Math.round((_this.data.getValue(day - 1, 1) + sum) * 100) / 100));
      }
      return _results;
    };
    this.createChart();
    this.createDataTable();
    this.data.addColumn("number", "Dia");
    this.data.addColumn("number", "Área");
    daysInMonth = new Date(chart1._yearsSlct.value, chart1._monthsSlct.value + 1, 0).getDate();
    firstPeriod = new Date(chart1._yearsSlct.value, chart1._monthsSlct.value, 1);
    secondPeriod = new Date(chart1._yearsSlct.value, chart1._monthsSlct.value, daysInMonth);
    data = [];
    for (day = _k = 1; 1 <= daysInMonth ? _k <= daysInMonth : _k >= daysInMonth; day = 1 <= daysInMonth ? ++_k : --_k) {
      data[0] = day;
      data[1] = 0;
      this.data.addRow(data);
    }
    if (H5.Data.state === "Todos") {
      $.each(H5.DB.diary.data.states, function(state, value) {
        return createTable(state);
      });
    } else {
      createTable(H5.Data.state);
    }
    months = {
      0: "Janeiro",
      1: "Fevereiro",
      2: "Março",
      3: "Abril",
      4: "Maio",
      5: "Junho",
      6: "Julho",
      7: "Agosto",
      8: "Setembro",
      9: "Outubro",
      10: "Novembro",
      11: "Dezembro"
    };
    this.changeTitle("Alerta DETER: Índice Diário [" + months[chart1._monthsSlct.value] + "]");
    options = {
      title: "",
      titleTextStyle: {
        color: "#333",
        fontSize: 13
      },
      backgroundColor: "transparent",
      legend: "none",
      chartArea: {
        width: "70%",
        height: "70%"
      },
      colors: ['#3ABCFC'],
      vAxis: {
        title: "Área km²"
      },
      hAxis: {
        title: "Dias",
        gridlines: {
          color: "#CCC",
          count: daysInMonth / 5
        }
      },
      animation: H5.Data.animate
    };
    return this.chart.draw(this.data, options);
  };

  chart2 = new H5.Charts.GoogleCharts({
    type: "Area",
    container: "chart2",
    period: 2,
    title: "Alerta DETER: Índice Mensal",
    buttons: {
      minusplus: true,
      "export": true,
      table: true,
      minimize: true,
      maximize: true
    }
  });

  chart2._addBtn.onclick = function() {
    chart2.options.period++;
    return chart2.drawChart();
  };

  chart2._delBtn.onclick = function() {
    chart2.options.period--;
    return chart2.drawChart();
  };

  chart2.drawChart = function() {
    var data, month, options, sumValues, _k, _l, _ref2, _ref3, _ref4,
      _this = this;
    sumValues = function(year, month) {
      var firstPeriod, secondPeriod, sum;
      sum = 0;
      firstPeriod = new Date(year - 1, 7, 1);
      secondPeriod = new Date(year, 7, 0);
      if (H5.Data.state === "Todos") {
        $.each(H5.DB.diary.data.states, function(key, state) {
          return $.each(state, function(key, reg) {
            var _ref2;
            if ((firstPeriod <= (_ref2 = reg.date) && _ref2 <= secondPeriod) && reg.month === month) {
              return sum += reg.area;
            }
          });
        });
      } else {
        $.each(H5.DB.diary.data.states[H5.Data.state], function(key, reg) {
          var _ref2;
          if ((firstPeriod <= (_ref2 = reg.date) && _ref2 <= secondPeriod) && reg.month === month) {
            return sum += reg.area;
          }
        });
      }
      return Math.round(sum * 100) / 100;
    };
    this.createChart();
    this.createDataTable();
    this.data.addColumn("string", "Mês");
    for (i = _k = 0, _ref2 = this.options.period; 0 <= _ref2 ? _k < _ref2 : _k > _ref2; i = 0 <= _ref2 ? ++_k : --_k) {
      this.data.addColumn("number", H5.Data.periods[i]);
    }
    for (month in H5.Data.months) {
      data = [H5.Data.months[month]];
      month = parseInt(month);
      if ((7 <= (_ref3 = month + 7) && _ref3 <= 11)) {
        month += 7;
      } else {
        month -= 5;
      }
      for (i = _l = 1, _ref4 = this.options.period; 1 <= _ref4 ? _l <= _ref4 : _l >= _ref4; i = 1 <= _ref4 ? ++_l : --_l) {
        data[i] = sumValues(H5.Data.thisYear - i + 1, month);
      }
      this.data.addRow(data);
    }
    options = {
      title: "",
      titleTextStyle: {
        color: "#333",
        fontSize: 13
      },
      backgroundColor: "transparent",
      focusTarget: "category",
      chartArea: {
        width: "70%",
        height: "80%"
      },
      colors: ['#3ABCFC', '#FC2121', '#D0FC3F', '#FCAC0A', '#67C2EF', '#FF5454', '#CBE968', '#FABB3D', '#77A4BD', '#CC6C6C', '#A6B576', '#C7A258'],
      vAxis: {
        title: "Área km²"
      },
      animation: H5.Data.animate
    };
    this._addBtn.disabled = true;
    this._delBtn.disabled = true;
    google.visualization.events.addListener(this.chart, "ready", function() {
      _this._addBtn.disabled = _this.options.period > H5.Data.totalPeriods;
      return _this._delBtn.disabled = _this.options.period < 2;
    });
    return this.chart.draw(this.data, options);
  };

  chart3 = new H5.Charts.GoogleCharts({
    type: "Bar",
    container: "chart3",
    period: 1,
    title: "Alerta DETER: Índice Períodos",
    buttons: {
      minusplus: true,
      "export": true,
      table: true,
      minimize: true,
      maximize: true
    }
  });

  chart3._addBtn.onclick = function() {
    chart3.options.period++;
    return chart3.drawChart();
  };

  chart3._delBtn.onclick = function() {
    chart3.options.period--;
    return chart3.drawChart();
  };

  chart3.drawChart = function() {
    var data, options, sumAvg, sumAvgValues, sumTotal, sumTotalValues, sumValues, _k, _ref2,
      _this = this;
    sumValues = function(firstPeriod, secondPeriod) {
      var sum;
      sum = 0;
      if (H5.Data.state === "Todos") {
        $.each(H5.DB.diary.data.states, function(key, state) {
          return $.each(state, function(key, reg) {
            var _ref2;
            if ((firstPeriod <= (_ref2 = reg.date) && _ref2 <= secondPeriod)) {
              return sum += reg.area;
            }
          });
        });
      } else {
        $.each(H5.DB.diary.data.states[H5.Data.state], function(key, reg) {
          var _ref2;
          if ((firstPeriod <= (_ref2 = reg.date) && _ref2 <= secondPeriod)) {
            return sum += reg.area;
          }
        });
      }
      return Math.round(sum * 100) / 100;
    };
    sumTotalValues = function(year) {
      var firstPeriod, secondPeriod;
      firstPeriod = new Date(year - 1, 7, 1);
      secondPeriod = new Date(year, 7, 0);
      return sumValues(firstPeriod, secondPeriod);
    };
    sumAvgValues = function(year) {
      var firstPeriod, month, secondPeriod;
      month = parseInt(chart1._monthsSlct.value);
      firstPeriod = new Date(year - 1, 7, 1);
      if (month > 6) {
        secondPeriod = new Date(year - 1, month + 1, 0);
      } else if (month !== H5.Data.thisMonth) {
        secondPeriod = new Date(year, month + 1, 0);
      } else {
        secondPeriod = new Date(year, month, H5.Data.thisDay);
      }
      return sumValues(firstPeriod, secondPeriod);
    };
    this.createChart();
    this.createDataTable();
    this.data.addColumn("string", "Ano");
    this.data.addColumn("number", "Parcial");
    this.data.addColumn("number", "Diferença");
    for (i = _k = 0, _ref2 = this.options.period; 0 <= _ref2 ? _k <= _ref2 : _k >= _ref2; i = 0 <= _ref2 ? ++_k : --_k) {
      data = [H5.Data.periods[i]];
      sumTotal = sumTotalValues(H5.Data.thisYear - i);
      sumAvg = sumAvgValues(H5.Data.thisYear - i);
      data[1] = sumAvg;
      data[2] = Math.round((sumTotal - sumAvg) * 100) / 100;
      this.data.addRow(data);
    }
    options = {
      title: "",
      titleTextStyle: {
        color: "#333",
        fontSize: 13
      },
      backgroundColor: "transparent",
      focusTarget: "category",
      chartArea: {
        width: "68%",
        height: "76%"
      },
      colors: ['#3ABCFC', '#FC2121'],
      vAxis: {
        title: "Período PRODES"
      },
      hAxis: {
        title: "Área km²"
      },
      bar: {
        groupWidth: "80%"
      },
      isStacked: true,
      animation: H5.Data.animate
    };
    this._addBtn.disabled = true;
    this._delBtn.disabled = true;
    google.visualization.events.addListener(this.chart, "ready", function() {
      _this._addBtn.disabled = _this.options.period > H5.Data.totalPeriods - 1;
      return _this._delBtn.disabled = _this.options.period < 2;
    });
    return this.chart.draw(this.data, options);
  };

  chart4 = new H5.Charts.GoogleCharts({
    type: "Column",
    container: "chart4",
    period: 2,
    title: "Alerta DETER: UFs",
    buttons: {
      minusplus: true,
      "export": true,
      table: true,
      minimize: true,
      maximize: true
    }
  });

  chart4._addBtn.onclick = function() {
    chart4.options.period++;
    return chart4.drawChart();
  };

  chart4._delBtn.onclick = function() {
    chart4.options.period--;
    return chart4.drawChart();
  };

  chart4.drawChart = function() {
    var data, j, options, sumValues, _k, _l, _ref2, _ref3,
      _this = this;
    sumValues = function(state, year) {
      var firstPeriod, secondPeriod, sum;
      sum = 0;
      firstPeriod = new Date(year - 1, 7, 1);
      secondPeriod = new Date(year, 7, 0);
      $.each(H5.DB.diary.data.states[state], function(key, reg) {
        var _ref2;
        if ((firstPeriod <= (_ref2 = reg.date) && _ref2 <= secondPeriod)) {
          return sum += reg.area;
        }
      });
      return Math.round(sum * 100) / 100;
    };
    this.createChart();
    this.createDataTable();
    this.data.addColumn("string", "Estado");
    for (i = _k = 0, _ref2 = this.options.period; 0 <= _ref2 ? _k < _ref2 : _k > _ref2; i = 0 <= _ref2 ? ++_k : --_k) {
      this.data.addColumn("number", H5.Data.periods[i]);
    }
    if (H5.Data.state === "Todos") {
      $.each(H5.DB.diary.data.states, function(state, reg) {
        var data, j, _l, _ref3;
        data = [state];
        for (j = _l = 1, _ref3 = _this.options.period; 1 <= _ref3 ? _l <= _ref3 : _l >= _ref3; j = 1 <= _ref3 ? ++_l : --_l) {
          data[j] = sumValues(state, H5.Data.thisYear - j + 1);
        }
        return _this.data.addRow(data);
      });
    } else {
      data = [H5.Data.state];
      for (j = _l = 1, _ref3 = this.options.period; 1 <= _ref3 ? _l <= _ref3 : _l >= _ref3; j = 1 <= _ref3 ? ++_l : --_l) {
        data[j] = sumValues(H5.Data.state, H5.Data.thisYear - j + 1);
      }
      this.data.addRow(data);
    }
    options = {
      title: "",
      titleTextStyle: {
        color: "#333",
        fontSize: 13
      },
      backgroundColor: "transparent",
      focusTarget: "category",
      chartArea: {
        width: "70%",
        height: "76%"
      },
      colors: ['#3ABCFC', '#FC2121', '#D0FC3F', '#FCAC0A', '#67C2EF', '#FF5454', '#CBE968', '#FABB3D', '#77A4BD', '#CC6C6C', '#A6B576', '#C7A258'],
      bar: {
        groupWidth: "100%"
      },
      vAxis: {
        title: "Área km²"
      },
      animation: H5.Data.animate
    };
    this._addBtn.disabled = true;
    this._delBtn.disabled = true;
    google.visualization.events.addListener(this.chart, "ready", function() {
      _this._addBtn.disabled = _this.options.period > H5.Data.totalPeriods;
      return _this._delBtn.disabled = _this.options.period < 2;
    });
    return this.chart.draw(this.data, options);
  };

  chart5 = new H5.Charts.GoogleCharts({
    type: "Area",
    container: "chart5",
    title: "Taxa PRODES|Alerta DETER: Acumulado Períodos",
    buttons: {
      "export": true,
      table: true,
      minimize: true,
      maximize: true
    }
  });

  chart5.drawChart = function() {
    var data, options, sumDeter, sumProdes;
    sumDeter = function(year) {
      var firstPeriod, secondPeriod, sum;
      sum = 0;
      firstPeriod = new Date(year - 1, 7, 1);
      secondPeriod = new Date(year, 7, 0);
      if (H5.Data.state === "Todos") {
        $.each(H5.DB.diary.data.states, function(key, state) {
          return $.each(state, function(key, reg) {
            var _ref2;
            if ((firstPeriod <= (_ref2 = reg.date) && _ref2 <= secondPeriod)) {
              return sum += reg.area;
            }
          });
        });
      } else {
        $.each(H5.DB.diary.data.states[H5.Data.state], function(key, reg) {
          var _ref2;
          if ((firstPeriod <= (_ref2 = reg.date) && _ref2 <= secondPeriod)) {
            return sum += reg.area;
          }
        });
      }
      if (sum >= 0) {
        return Math.round(sum * 100) / 100;
      }
    };
    sumProdes = function(period) {
      var sum;
      sum = 0;
      if (H5.Data.state === "Todos") {
        $.each(H5.DB.prodes.data.states, function(key, state) {
          return sum += state[period].area;
        });
      } else {
        sum = H5.DB.prodes.data.states[H5.Data.state][period].area;
      }
      if (sum >= 0) {
        return sum;
      }
    };
    this.createChart();
    this.createDataTable();
    this.data.addColumn("string", "Ano");
    this.data.addColumn("number", "Alerta DETER");
    this.data.addColumn("number", "Taxa PRODES");
    i = H5.Data.totalPeriods;
    while (i >= 0) {
      data = [H5.Data.periods[i]];
      data[1] = sumDeter(H5.Data.thisYear - i);
      data[2] = sumProdes(H5.Data.periods[i]);
      this.data.addRow(data);
      i--;
    }
    options = {
      title: "",
      titleTextStyle: {
        color: "#333",
        fontSize: 13
      },
      backgroundColor: "transparent",
      focusTarget: "category",
      chartArea: {
        width: "70%",
        height: "80%"
      },
      colors: ['#3ABCFC', '#D0FC3F'],
      vAxis: {
        title: "Área km²"
      },
      hAxis: {
        title: "H5.Data.periods"
      },
      animation: H5.Data.animate
    };
    return this.chart.draw(this.data, options);
  };

  chart6 = new H5.Charts.GoogleCharts({
    type: "Column",
    container: "chart6",
    period: 1,
    title: "Taxa PRODES|Alerta DETER: UFs",
    buttons: {
      "export": true,
      table: true,
      minimize: true,
      maximize: true,
      arrows: true
    }
  });

  chart6.changeTitle(H5.Data.periods[chart6.options.period]);

  chart6._leftBtn.onclick = function() {
    chart6.options.period++;
    return chart6.drawChart();
  };

  chart6._rightBtn.onclick = function() {
    chart6.options.period--;
    return chart6.drawChart();
  };

  chart6.drawChart = function() {
    var data, options, sumDeter, sumProdes,
      _this = this;
    sumDeter = function(state, year) {
      var firstPeriod, secondPeriod, sum;
      sum = 0;
      firstPeriod = new Date(year - 1, 7, 1);
      secondPeriod = new Date(year, 7, 0);
      $.each(H5.DB.diary.data.states[state], function(key, reg) {
        var _ref2;
        if ((firstPeriod <= (_ref2 = reg.date) && _ref2 <= secondPeriod)) {
          return sum += reg.area;
        }
      });
      return Math.round(sum * 100) / 100;
    };
    sumProdes = function(state, year) {
      var period, sum;
      sum = 0;
      period = (year - 1) + "-" + year;
      $.each(H5.DB.prodes.data.states[state], function(key, reg) {
        if (key === period) {
          if (reg.area != null) {
            return sum += reg.area;
          }
        }
      });
      return Math.round(sum * 100) / 100;
    };
    this.createChart();
    this.createDataTable();
    this.data.addColumn("string", "Estado");
    this.data.addColumn("number", "Alerta DETER");
    this.data.addColumn("number", "Taxa PRODES");
    if (H5.Data.state === "Todos") {
      $.each(H5.DB.diary.data.states, function(state, reg) {
        var data;
        data = [state];
        data[1] = sumDeter(state, H5.Data.thisYear - _this.options.period);
        data[2] = sumProdes(state, H5.Data.thisYear - _this.options.period);
        return _this.data.addRow(data);
      });
    } else {
      data = [H5.Data.state];
      data[1] = sumDeter(H5.Data.state, H5.Data.thisYear - this.options.period);
      data[2] = sumProdes(H5.Data.state, H5.Data.thisYear - this.options.period);
      this.data.addRow(data);
    }
    options = {
      title: "",
      titleTextStyle: {
        color: "#333",
        fontSize: 13
      },
      backgroundColor: "transparent",
      focusTarget: "category",
      chartArea: {
        width: "70%",
        height: "76%"
      },
      colors: ['#3ABCFC', '#D0FC3F'],
      bar: {
        groupWidth: "100%"
      },
      vAxis: {
        title: "Área km²"
      },
      animation: H5.Data.animate
    };
    this.changeTitle("Taxa PRODES|Alerta DETER: UFs [" + H5.Data.periods[this.options.period] + "]");
    this._rightBtn.disabled = true;
    this._leftBtn.disabled = true;
    google.visualization.events.addListener(this.chart, "ready", function() {
      _this._rightBtn.disabled = _this.options.period < 2;
      return _this._leftBtn.disabled = _this.options.period >= H5.Data.totalPeriods;
    });
    return this.chart.draw(this.data, options);
  };

  chart7 = new H5.Charts.GoogleCharts({
    type: "Pie",
    container: "chart7",
    period: 0,
    buttons: {
      arrows: true,
      "export": true,
      table: true,
      minimize: true,
      maximize: true
    }
  });

  chart7.changeTitle(H5.Data.periods[chart7.options.period]);

  chart7._leftBtn.onclick = function() {
    chart7.options.period++;
    return chart7.drawChart();
  };

  chart7._rightBtn.onclick = function() {
    chart7.options.period--;
    return chart7.drawChart();
  };

  chart7.drawChart = function() {
    var data, estado, options, sumValues, _k, _ref2,
      _this = this;
    sumValues = function(state, year) {
      var firstPeriod, secondPeriod, sum;
      sum = 0;
      firstPeriod = new Date(year - 1, 7, 1);
      secondPeriod = new Date(year, 7, 0);
      $.each(H5.DB.diary.data.states[state], function(key, reg) {
        var _ref2;
        if ((firstPeriod <= (_ref2 = reg.date) && _ref2 <= secondPeriod)) {
          return sum += reg.area;
        }
      });
      return Math.round(sum * 100) / 100;
    };
    this.createChart();
    this.createDataTable();
    this.data.addColumn("string", "Mês");
    this.data.addColumn("number", H5.Data.periods[this.options.period]);
    for (i = _k = 0, _ref2 = H5.Data.states.length; 0 <= _ref2 ? _k < _ref2 : _k > _ref2; i = 0 <= _ref2 ? ++_k : --_k) {
      estado = H5.Data.states[i];
      data = [estado];
      data[1] = sumValues(H5.Data.states[i], H5.Data.thisYear - this.options.period);
      this.data.addRow(data);
    }
    options = {
      title: "",
      titleTextStyle: {
        color: "#333",
        fontSize: 13
      },
      chartArea: {
        width: "90%",
        height: "80%"
      },
      colors: ['#3ABCFC', '#FC2121', '#D0FC3F', '#FCAC0A', '#67C2EF', '#FF5454', '#CBE968', '#FABB3D', '#77A4BD', '#CC6C6C', '#A6B576', '#C7A258'],
      backgroundColor: "transparent"
    };
    this.changeTitle(H5.Data.periods[this.options.period]);
    this._rightBtn.disabled = true;
    this._leftBtn.disabled = true;
    google.visualization.events.addListener(this.chart, "ready", function() {
      _this._rightBtn.disabled = _this.options.period < 1;
      return _this._leftBtn.disabled = _this.options.period >= H5.Data.totalPeriods;
    });
    return this.chart.draw(this.data, options);
  };

  chart8 = new H5.Charts.GoogleCharts({
    type: "Pie",
    container: "chart8",
    period: 1,
    buttons: {
      "export": true,
      table: true,
      minimize: true,
      maximize: true
    }
  });

  chart8.drawChart = function() {
    var data, daysInMonth, estado, firstPeriod, options, pieText, pieTooltip, secondPeriod, sumValues, _k, _ref2;
    sumValues = function(state) {
      var sum;
      sum = 0;
      $.each(H5.DB.diary.data.states[state], function(key, reg) {
        var _ref2;
        if ((firstPeriod <= (_ref2 = reg.date) && _ref2 <= secondPeriod)) {
          return sum += reg.area;
        }
      });
      if (firstPeriod > H5.Data.thisDate) {
        return 1;
      } else {
        return Math.round(sum * 100) / 100;
      }
    };
    this.createChart();
    this.createDataTable();
    this.data.addColumn("string", "Estado");
    this.data.addColumn("number", "Área Total");
    daysInMonth = new Date(chart1._yearsSlct.value, chart1._monthsSlct.value + 1, 0).getDate();
    firstPeriod = new Date(chart1._yearsSlct.value, chart1._monthsSlct.value, 1);
    secondPeriod = new Date(chart1._yearsSlct.value, chart1._monthsSlct.value, daysInMonth);
    if (firstPeriod > H5.Data.thisDate) {
      pieText = "none";
      pieTooltip = "none";
    } else {
      pieText = "percent";
      pieTooltip = "focus";
    }
    for (i = _k = 0, _ref2 = H5.Data.states.length; 0 <= _ref2 ? _k < _ref2 : _k > _ref2; i = 0 <= _ref2 ? ++_k : --_k) {
      estado = H5.Data.states[i];
      data = [estado];
      data[1] = sumValues(H5.Data.states[i]);
      this.data.addRow(data);
    }
    this.changeTitle(chart1._monthsSlct.options[chart1._monthsSlct.value].label + ", " + chart1._yearsSlct.value);
    options = {
      title: "",
      titleTextStyle: {
        color: "#333",
        fontSize: 13
      },
      backgroundColor: "transparent",
      focusTarget: "category",
      pieSliceText: pieText,
      tooltip: {
        trigger: pieTooltip
      },
      chartArea: {
        width: "90%",
        height: "80%"
      },
      colors: ['#3ABCFC', '#FC2121', '#D0FC3F', '#FCAC0A', '#67C2EF', '#FF5454', '#CBE968', '#FABB3D', '#77A4BD', '#CC6C6C', '#A6B576', '#C7A258'],
      bar: {
        groupWidth: "100%"
      },
      vAxis: {
        title: "Área km²"
      },
      animation: H5.Data.animate
    };
    return this.chart.draw(this.data, options);
  };

  chart9 = new H5.Charts.GoogleCharts({
    type: "Line",
    container: "chart9",
    period: 2,
    title: "Alerta DETER: Taxa(%) de Nuvens",
    buttons: {
      minusplus: true,
      "export": true,
      table: true,
      minimize: true,
      maximize: true
    }
  });

  chart9._addBtn.onclick = function() {
    chart9.options.period++;
    return chart9.drawChart();
  };

  chart9._delBtn.onclick = function() {
    chart9.options.period--;
    return chart9.drawChart();
  };

  chart9.drawChart = function() {
    var data, month, options, sumValues, _k, _l, _ref2, _ref3, _ref4,
      _this = this;
    sumValues = function(year, month) {
      var firstPeriod, percent, secondPeriod;
      percent = 0;
      firstPeriod = new Date(year - 1, 7, 1);
      secondPeriod = new Date(year, 7, 0);
      $.each(H5.DB.cloud.data.nuvem, function(key, nuvem) {
        if (nuvem.date >= firstPeriod && nuvem.date <= secondPeriod && nuvem.month === month) {
          percent = nuvem.value;
          return false;
        }
      });
      return Math.round(percent * 100);
    };
    this.createChart();
    this.createDataTable();
    this.data.addColumn("string", "Mês");
    for (i = _k = 0, _ref2 = this.options.period; 0 <= _ref2 ? _k < _ref2 : _k > _ref2; i = 0 <= _ref2 ? ++_k : --_k) {
      this.data.addColumn("number", H5.Data.periods[i]);
    }
    for (month in H5.Data.months) {
      data = [H5.Data.months[month]];
      month = parseInt(month);
      if ((7 <= (_ref3 = month + 7) && _ref3 <= 11)) {
        month += 7;
      } else {
        month -= 5;
      }
      for (i = _l = 1, _ref4 = this.options.period; 1 <= _ref4 ? _l <= _ref4 : _l >= _ref4; i = 1 <= _ref4 ? ++_l : --_l) {
        data[i] = sumValues(H5.Data.thisYear - i + 1, month);
      }
      this.data.addRow(data);
    }
    options = {
      title: "",
      titleTextStyle: {
        color: "#333",
        fontSize: 13
      },
      backgroundColor: "transparent",
      focusTarget: "category",
      chartArea: {
        width: "70%",
        height: "80%"
      },
      colors: ['#3ABCFC', '#FC2121', '#D0FC3F', '#FCAC0A', '#67C2EF', '#FF5454', '#CBE968', '#FABB3D', '#77A4BD', '#CC6C6C', '#A6B576', '#C7A258'],
      vAxis: {
        title: "Porcentagem"
      },
      animation: H5.Data.animate
    };
    this._addBtn.disabled = true;
    this._delBtn.disabled = true;
    google.visualization.events.addListener(this.chart, "ready", function() {
      _this._addBtn.disabled = _this.options.period > H5.Data.totalPeriods - 4;
      return _this._delBtn.disabled = _this.options.period < 2;
    });
    return this.chart.draw(this.data, options);
  };

  spark1 = new H5.Charts.Sparks({
    container: "spark1",
    title: "Total Mensal"
  });

  spark1.drawChart = function() {
    var createTable, data, day, daysInMonth, firstPeriod, secondPeriod, value, _k,
      _this = this;
    createTable = function(state) {
      var day, dayValue, _k, _results;
      dayValue = 0;
      _results = [];
      for (day = _k = 1; 1 <= daysInMonth ? _k <= daysInMonth : _k >= daysInMonth; day = 1 <= daysInMonth ? ++_k : --_k) {
        $.each(H5.DB.diary.data.states[state], function(key, reg) {
          var _ref2;
          if ((firstPeriod <= (_ref2 = reg.date) && _ref2 <= secondPeriod) && reg.day === day) {
            dayValue += reg.area;
            return false;
          }
        });
        _results.push(data[day - 1] = Math.round((data[day - 1] + dayValue) * 100) / 100);
      }
      return _results;
    };
    daysInMonth = new Date(chart1._yearsSlct.value, chart1._monthsSlct.value + 1, 0).getDate();
    firstPeriod = new Date(chart1._yearsSlct.value, chart1._monthsSlct.value, 1);
    secondPeriod = new Date(chart1._yearsSlct.value, chart1._monthsSlct.value, daysInMonth);
    data = [];
    for (day = _k = 1; 1 <= daysInMonth ? _k <= daysInMonth : _k >= daysInMonth; day = 1 <= daysInMonth ? ++_k : --_k) {
      data[day - 1] = 0;
    }
    if (H5.Data.state === "Todos") {
      $.each(H5.DB.diary.data.states, function(state, value) {
        return createTable(state);
      });
    } else {
      createTable(H5.Data.state);
    }
    value = data[daysInMonth - 1];
    return this.updateInfo(data, value);
  };

  spark2 = new H5.Charts.Sparks({
    container: "spark2",
    title: "Total Período"
  });

  spark2.drawChart = function() {
    var data, sumValues, value,
      _this = this;
    sumValues = function(year, month) {
      var firstPeriod, secondPeriod, sum;
      sum = 0;
      firstPeriod = new Date(year - 1, 7, 1);
      secondPeriod = new Date(year, 7, 0);
      if (H5.Data.state === "Todos") {
        $.each(H5.DB.diary.data.states, function(key, state) {
          return $.each(state, function(key, reg) {
            if (reg.date >= firstPeriod && reg.date <= secondPeriod && reg.month === month) {
              return sum += reg.area;
            }
          });
        });
      } else {
        $.each(H5.DB.diary.data.states[H5.Data.state], function(key, reg) {
          if (reg.date >= firstPeriod && reg.date <= secondPeriod && reg.month === month) {
            return sum += reg.area;
          }
        });
      }
      return Math.round(sum * 100) / 100;
    };
    data = [];
    $.each(H5.Data.months, function(number, month) {
      var _ref2;
      i = number;
      number = parseInt(number);
      if ((7 <= (_ref2 = number + 7) && _ref2 <= 11)) {
        number += 7;
      } else {
        number -= 5;
      }
      return data[i] = sumValues(chart1._yearsSlct.value, number);
    });
    value = 0;
    $.each(data, function() {
      return value += this;
    });
    return this.updateInfo(data, Math.round(value * 100) / 100);
  };

  knob1 = new H5.Charts.Knobs({
    container: "knob1",
    title: "Taxa VAA",
    popover: "Taxa de variação em relação ao mesmo mês do ano anterior"
  });

  knob1.drawChart = function() {
    var periodDeforestationRate, value;
    periodDeforestationRate = function(year, month) {
      var curDate, curValue, preDate, preValue, sumValues;
      sumValues = function(date) {
        var reg, state, sum, _ref2, _ref3;
        sum = 0;
        if (H5.Data.state === "Todos") {
          for (state in H5.DB.diary.data.states) {
            for (reg in H5.DB.diary.data.states[state]) {
              reg = H5.DB.diary.data.states[state][reg];
              if ((date.getFullYear() <= (_ref2 = reg.year) && _ref2 <= date.getFullYear()) && reg.month === date.getMonth()) {
                sum += reg.area;
              }
            }
          }
        } else {
          for (reg in H5.DB.diary.data.states[H5.Data.state]) {
            reg = H5.DB.diary.data.states[H5.Data.state][reg];
            if ((date.getFullYear() <= (_ref3 = reg.year) && _ref3 <= date.getFullYear()) && reg.month === date.getMonth()) {
              sum += reg.area;
            }
          }
        }
        return sum;
      };
      curDate = new Date(year, month);
      preDate = new Date(year - 1, month);
      curValue = sumValues(curDate);
      preValue = sumValues(preDate);
      if (preValue === 0) {
        return 0;
      } else {
        return Math.round((curValue - preValue) / preValue * 100);
      }
    };
    value = periodDeforestationRate(parseInt(chart1._yearsSlct.value), parseInt(chart1._monthsSlct.value));
    return this.updateInfo(value);
  };

  knob2 = new H5.Charts.Knobs({
    container: "knob2",
    title: "Taxa VMA",
    popover: "Taxa de variação em relação ao mês anterior"
  });

  knob2.drawChart = function() {
    var periodDeforestationRate, value;
    periodDeforestationRate = function(year, month) {
      var curDate, curValue, preDate, preValue, sumValues;
      sumValues = function(date) {
        var reg, state, sum, _ref2, _ref3;
        sum = 0;
        if (H5.Data.state === "Todos") {
          for (state in H5.DB.diary.data.states) {
            for (reg in H5.DB.diary.data.states[state]) {
              reg = H5.DB.diary.data.states[state][reg];
              if ((date.getFullYear() <= (_ref2 = reg.year) && _ref2 <= date.getFullYear()) && reg.month === date.getMonth()) {
                sum += reg.area;
              }
            }
          }
        } else {
          for (reg in H5.DB.diary.data.states[H5.Data.state]) {
            reg = H5.DB.diary.data.states[H5.Data.state][reg];
            if ((date.getFullYear() <= (_ref3 = reg.year) && _ref3 <= date.getFullYear()) && reg.month === date.getMonth()) {
              sum += reg.area;
            }
          }
        }
        return sum;
      };
      curDate = new Date(year, month);
      preDate = new Date(year, month - 1);
      curValue = sumValues(curDate);
      preValue = sumValues(preDate);
      if (preValue === 0) {
        return 0;
      } else {
        return Math.round((curValue - preValue) / preValue * 100);
      }
    };
    value = periodDeforestationRate(parseInt(chart1._yearsSlct.value), parseInt(chart1._monthsSlct.value));
    return this.updateInfo(value);
  };

  knob3 = new H5.Charts.Knobs({
    container: "knob3",
    title: "Taxa VPA",
    popover: "Taxa de variação em relação ao período PRODES anterior"
  });

  knob3.drawChart = function() {
    var periodDeforestationAvgRate, value;
    periodDeforestationAvgRate = function(year, month) {
      var curValue, preValue, sumPeriods, sumValues;
      sumValues = function(firstPeriod, secondPeriod) {
        var sum;
        sum = 0;
        if (H5.Data.state === "Todos") {
          $.each(H5.DB.diary.data.states, function(key, state) {
            return $.each(state, function(key, reg) {
              var _ref2;
              if ((firstPeriod <= (_ref2 = reg.date) && _ref2 <= secondPeriod)) {
                return sum += reg.area;
              }
            });
          });
        } else {
          $.each(H5.DB.diary.data.states[H5.Data.state], function(key, reg) {
            var _ref2;
            if ((firstPeriod <= (_ref2 = reg.date) && _ref2 <= secondPeriod)) {
              return sum += reg.area;
            }
          });
        }
        return Math.round(sum * 100) / 100;
      };
      if (month > 6) {
        year++;
      } else {
        year;
      }
      sumPeriods = function(year, month) {
        var firstPeriod, secondPeriod;
        firstPeriod = new Date(year - 1, 7, 1);
        secondPeriod = new Date(year, month + 1, 0);
        return sumValues(firstPeriod, secondPeriod);
      };
      curValue = sumPeriods(year, month);
      preValue = sumPeriods(year - 1, month);
      if (preValue === 0) {
        return 0;
      } else {
        return Math.round((curValue - preValue) / preValue * 100);
      }
    };
    value = periodDeforestationAvgRate(parseInt(chart1._yearsSlct.value), parseInt(chart1._monthsSlct.value));
    return this.updateInfo(value);
  };

  H5.Charts.reloadCharts = function() {
    chart1.drawChart();
    chart2.drawChart();
    chart3.drawChart();
    chart4.drawChart();
    chart5.drawChart();
    chart6.drawChart();
    chart7.drawChart();
    chart8.drawChart();
    chart9.drawChart();
    knob1.drawChart();
    knob2.drawChart();
    knob3.drawChart();
    spark1.drawChart();
    return spark2.drawChart();
  };

  H5.Charts.updateMap = function() {
    var where;
    if (H5.Data.state === "Todos") {
      where = "ano='" + H5.Data.selectedYear + "'";
    } else {
      where = "estado='" + H5.Data.state + "' AND ano='" + H5.Data.selectedYear + "'";
    }
    H5.Map.layer.alerta.setOptions({
      where: where
    });
    H5.Map.layer.alerta.setMap(null);
    return H5.Map.layer.alerta.setMap(H5.Map.base);
  };

}).call(this);
