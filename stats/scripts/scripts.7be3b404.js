"use strict";angular.module("estatisticasApp",["ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","chart.js","ngMask","ui.bootstrap","ngFileUpload"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"ChartsCtrl"}).when("/acidente",{templateUrl:"views/acidente.html",controller:"AcidenteCtrl"}).when("/html",{templateUrl:"views/html.html",controller:"PdfCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("estatisticasApp").controller("ChartsCtrl",["$scope","$rootScope","RestApi",function(a,b,c){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.anos=[];for(var d=new Date,e=2008;e<=d.getFullYear();e++)a.anos.push(e.toString());c.query({query:"vw_ocorrencia"},function(c){var d={};a.rest=c,a.numberOfElements=3,Chart.defaults.global.colours=["#00B2EE","#F7464A","#46BFBD","#7B68EE","#FDB45C","#949FB1","#8B5742"],d.regiao=b.regiao,d.ano=b.ano,d.mes=b.mes,d.evento=b.evento,d.origem=b.origem,d.data=c;for(var e={},f=0,g=b.regionsArray,h={},i=0;i<c.length;i++)-1!=(f=g.indexOf(c[i].regiao))&&null==e[g[f]]&&(e[g[f]]={}),e[g[f]][c[i].id_ocorrencia]={},h=e[g[f]][c[i].id_ocorrencia],h.dt_registro=c[i].dt_registro,h.dt_ocorrencia=c[i].dt_ocorrencia,h.regiao=c[i].regiao,h.origens=c[i].origem.replace(/[\"{}]+/g,"").split(","),h.eventos=c[i].eventos.replace(/[\"{}]+/g,"").split(","),h.danos=c[i].tipos_danos_identificados.replace(/[\"{}]+/g,"").split(","),h.instituicoes=c[i].institiuicoes_atuando_local.replace(/[\"{}]+/g,"").split(","),h.fontes=c[i].tipos_fontes_informacoes.replace(/[\"{}]+/g,"").split(",");d.data=e,a.restData=e,a.$broadcast("load_mensal",d),a.$broadcast("load_instituicoes",d),a.$broadcast("load_eventos",d),a.$broadcast("load_eventosmes",d)}),a.$on("filter",function(b,c){var d={};d.regiao=c.regiao,d.ano=c.ano,d.mes=c.mes,d.evento=c.evento,d.origem=c.origem,d.data=a.restData,a.$broadcast("load_mensal",d),a.$broadcast("load_instituicoes",d),a.$broadcast("load_eventos",d),a.$broadcast("load_eventosmes",d)})}]),angular.module("estatisticasApp").factory("RestApi",["$resource",function(a){return a("//"+document.location.hostname+document.location.pathname+"../moduleSiema.php?:type",{},{get:{method:"GET",params:{format:"json"},isArray:!0},post:{method:"POST",headers:{"Content-Type":"application/json"},isArray:!0}},{stripTrailingSlashes:!1})}]),angular.module("estatisticasApp").directive("instituicoes",["RestApi",function(){return{template:'<canvas class="chart-bar chart-stats" data="instituicoesData" labels="instituicoesLabel" legend="true" series="instituicoesSeries" options="instituicoesOptions"></canvas>',restrict:"E",link:function(a){a.$on("load_instituicoes",function(b,c){var d=(c.data,[]),e=0,f=a.numberOfElements,g=["IBAMA","Órgão Estadual ou Municipal de Meio Ambiente","Defesa Civil","Corpo de Bombeiros","Polícia Rodoviária","Polícia Militar","Polícia Civil","Marinha do Brasil","Empresa especializada em atendimento","Outra(s)","Todos"];d[0]=[],d[1]=[];for(var h=2007,i=(new Date).getFullYear(),j=i;j>=h&&d[0].length<f;j--)j<=c.ano&&d[0].push(j);for(var k=0;k<d[0].length;k++){d[1][k]=[];for(var l=0;l<g.length;l++)e=0,$.each(c.data,function(a,b){return"BRASIL"==c.regiao||a==c.regiao?$.each(b,function(a,b){var f=null;f=null!=b.dt_ocorrencia?b.dt_ocorrencia.split("-"):b.dt_registro.split("-");var h=b.instituicoes;if("Todos"===c.evento&&"Todos"===c.origem){if(f[0]==d[0][k]&&-1!=h.indexOf(g[l]))return e++}else if(f[0]==d[0][k]&&(b.origens.indexOf(c.origem)>=0||"Todos"===c.origem)&&(b.eventos.indexOf(c.evento)>=0||"Todos"===c.evento)&&-1!=h.indexOf(g[l]))return e++}):void 0}),d[1][k].push(e)}a.chart2="Número de Acidentes Atendidos por Instituições",a.instituicoesLabel=["IBAMA","OEMMA","DC","CB","PRF","PM","PC","Marinha","EEA","Outra(s)"],a.instituicoesSeries=d[0].slice(0,f),a.instituicoesOptions={animationSteps:5},a.instituicoesData=d[1].slice(0,f)})}}}]),angular.module("estatisticasApp").directive("eventos",function(){return{template:'<canvas class="chart-pie chart-stats" data="eventosData" labels="eventosLabels" legend="true" options="eventosOptions"></canvas> ',restrict:"E",link:function(a){a.$on("load_eventos",function(b,c){var d=(c.data,[]),e=0,f=c.ano,g=["NO","NE","CO","SE","SU",""];d[0]=["Norte","Nordeste","Centro-Oeste","Sudeste","Sul","Sem Região Cadastrada"],d[1]=[];for(var h=0;h<g.length;h++)e=0,$.each(c.data,function(a,b){return"BRASIL"==c.regiao||a==c.regiao?$.each(b,function(a,b){var d=null;if(d=null!=b.dt_ocorrencia?b.dt_ocorrencia.split("-"):b.dt_registro.split("-"),"Todos"===c.evento&&"Todos"===c.origem){if(d[0]==f&&b.regiao==g[h])return e++}else if(d[0]==f&&b.regiao==g[h]&&(b.origens.indexOf(c.origem)>=0||"Todos"===c.origem)&&(b.eventos.indexOf(c.evento)>=0||"Todos"===c.evento))return e++}):void 0}),d[1].push(e);a.chart3=f+" : Todos Tipos de Eventos : Todos Tipos de Origens",a.eventosLabels=d[0],a.eventosData=d[1],a.eventosOptions={animationSteps:5}})}}}),angular.module("estatisticasApp").directive("eventosmes",function(){return{template:'<canvas class="chart-pie chart-stats" data="eventosMesData" labels="eventosMesLabels" legend="true" options="eventosMesOptions"></canvas> ',restrict:"E",link:function(a){a.$on("load_eventosmes",function(b,c){var d=(c.data,[]),e=0,f=c.ano,g=c.mes,h=["","Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],i=["NO","NE","CO","SE","SU",""];d[0]=["Norte","Nordeste","Centro-Oeste","Sudeste","Sul","Sem Região Cadastrada"],d[1]=[];for(var j=0;j<i.length;j++)e=0,$.each(c.data,function(a,b){return"BRASIL"==c.regiao||a==c.regiao?$.each(b,function(a,b){var d=null;if(d=null!=b.dt_ocorrencia?b.dt_ocorrencia.split("-"):b.dt_registro.split("-"),"Todos"===c.evento&&"Todos"===c.origem){if(d[0]==f&&h[parseInt(d[1])]==g&&b.regiao==i[j])return e++}else if(d[0]==f&&b.regiao==i[j]&&d[1]==g&&(b.origens.indexOf(c.origem)>=0||"Todos"===c.origem)&&(b.eventos.indexOf(c.evento)>=0||"Todos"===c.evento))return e++}):void 0}),d[1].push(e);a.chart4=g+", "+f+": Todos Tipos de Eventos : Todos Tipos de Origens",a.eventosMesLabels=d[0],a.eventosMesData=d[1],a.eventosMesOptions={animationSteps:5}})}}}),angular.module("estatisticasApp").directive("mensal",["RestApi","$rootScope",function(){return{template:'<canvas class="chart-line chart-stats" data="mensalData" labels="mensalLabels" legend="true" series="mensalSeries" options="mensalOptions"></canvas> ',restrict:"E",link:function(a){a.$on("load_mensal",function(b,c){{var d=[],e=0,f=a.numberOfElements;c.data}d[0]=[],d[1]=[];for(var g=2007,h=(new Date).getFullYear(),i=h;i>=g&&d[0].length<f;i--)i<=c.ano&&d[0].push(i);for(var j=0;j<d[0].length;j++){d[1][j]=[];for(var k=1;12>=k;k++)e=0,$.each(c.data,function(a,b){return"BRASIL"==c.regiao||a==c.regiao?$.each(b,function(a,b){var f=null;if(f=null!=b.dt_ocorrencia?b.dt_ocorrencia.split("-"):b.dt_registro.split("-"),"Todos"===c.evento&&"Todos"===c.origem){if(f[0]==d[0][j]&&f[1]==k)return e++}else if(f[0]==d[0][j]&&f[1]==k&&(b.origens.indexOf(c.origem)>=0||"Todos"===c.origem)&&(b.eventos.indexOf(c.evento)>=0||"Todos"===c.evento))return e++}):void 0}),d[1][j].push(e)}var l=["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"];a.chart1="Acidentes: Índices Mensal",a.mensalLabels=l,a.mensalSeries=d[0].slice(0,f),a.mensalOptions={animationSteps:5,bezierCurve:!1},a.mensalData=d[1].slice(0,f)})}}}]),angular.module("estatisticasApp").controller("FormCtrl",["$scope","$rootScope",function(a,b){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.baseUrl="images/icons/",a.regions=[{name:"NE",image:a.baseUrl+"Nordeste.png",subtitle:"Nordeste"},{name:"NO",image:a.baseUrl+"Norte.png",subtitle:"Norte"},{name:"SU",image:a.baseUrl+"Sul.png",subtitle:"Sul"},{name:"CO",image:a.baseUrl+"CentroOeste.png",subtitle:"Centro-Oeste"},{name:"SE",image:a.baseUrl+"Sudeste.png",subtitle:"Sudeste"},{name:"BRASIL",image:a.baseUrl+"Brasil.png",subtitle:"Brasil"}],b.regionsArray=a.regions.map(function(a){return a.name}),a.meses=["Jan","Fev","Mar","Abr","Mai","Jun","Jul","Ago","Set","Out","Nov","Dez"],a.eventos=["Derramamento de ĺíquido","Desastre Natural","Explosão/Incêndio","Lançamento de sólidos","Mortandade de peixes","Produtos químicos/embalagens abandonadas","Rompimento de barragem","Vazamento de gases","Outro(s)","Todos"],a.origens=["Rodovia","Ferrovia","Terminal/Portos/Ancoradouros/etc.","Embarcação","Refinaria","Plataforma","Indústria","Duto","Barragem","Armazenamento/Depósito","Posto de Combustível","Outro(s)","Todos"],b.regiao="BRASIL",b.ano=(new Date).getFullYear().toString(),b.mes=a.meses[(new Date).getMonth()],b.evento="Todos",b.origem="Todos",a.getValueClass=function(b){a.regiao=b.$$watchers[2].last},a.changeClass=function(b){return b.$$watchers[2].last==a.regiao?"active":void 0},a.filter=function(){var c={};c.regiao=a.regiao,c.ano=a.ano,c.mes=a.mes,c.evento=a.evento,c.origem=a.origem,b.$broadcast("filter",c)}}]),angular.module("estatisticasApp").controller("AcidenteCtrl",["$scope","RestApi","$routeParams","$location","Upload","$http",function(a,b,c,d){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.accordions=["localizacao","mapa","datas","origem","evento","produtos","detalhes","ambiente","empresa","instituicao","acoes","gerais","comunicante","fonte"],angular.forEach(a.accordions,function(b){a[b]={},a[b].subPanel=""}),a.carregaParametros=function(){c.id&&(a.nro_ocorrencia=c.id),c.acao&&"carregar"==c.acao?a.acao="carregar":(a.acao="criar",a.oleo=c.oleo&&"true"==c.oleo?!0:!1),c.usuario?(a.usuario=c.usuario,a.email=c.email):a.usuario=null,c.validador&&(a.validador={},a.validador.ativado=c.validador,a.validador.validado=!1),c.comunicante&&(a.tipo_comunicante=c.comunicante)},a.carregaParametros(),a.rests=0,b.query({query:"ufs"},function(b){a.ufs=[],angular.forEach(b,function(b){a.ufs.push({name:b.sigla,fullname:b.estado,value:b.id_uf})}),a.rests++,a.$broadcast("carregar_occur",a.rests)}),b.query({query:"bacias"},function(b){a.bacias=[],angular.forEach(b,function(b){a.bacias.push({name:b.nome,value:b.id_bacia_sedimentar})}),a.rests++,a.$broadcast("carregar_occur",a.rests)}),b.query({query:"origens"},function(b){a.origens=[],angular.forEach(b,function(b){a.origens.push({name:b.des_tipo_localizacao,id:b.id_tipo_localizacao,value:!1})}),a.rests++,a.$broadcast("carregar_occur",a.rests)}),b.query({query:"eventos"},function(b){a.eventos=[],angular.forEach(b,function(b){a.eventos.push({name:b.nome,id:b.id_tipo_evento,value:!1})}),a.rests++,a.$broadcast("carregar_occur",a.rests)}),b.query({query:"ambientes"},function(b){a.ambientes=[],angular.forEach(b,function(b){a.ambientes.push({name:b.nome,id:b.id_tipo_dano_identificado,value:!1})}),a.rests++,a.$broadcast("carregar_occur",a.rests)}),b.query({query:"instituicoes"},function(b){a.instituicoes=[],angular.forEach(b,function(b){a.instituicoes.push({name:b.nome,id:b.id_instituicao_atuando_local,value:!1})}),a.rests++,a.$broadcast("carregar_occur",a.rests)}),b.query({query:"fontes"},function(b){a.fontes=[],angular.forEach(b,function(b){a.fontes.push({name:b.nome,id:b.id_tipo_fonte_informacao,value:!1})}),a.rests++,a.$broadcast("carregar_occur",a.rests)}),b.query({query:"produtos_onu"},function(b){a.produtos_onu=[],angular.forEach(b,function(b){var c=b.nome+" - "+b.num_onu+" - "+b.classe_risco;a.produtos_onu.push({field:c,id:b.id})}),a.rests++,a.$broadcast("carregar_occur",a.rests)}),b.query({query:"produtos_outros"},function(b){b&&(a.produtos_outros=[],angular.forEach(b,function(b){a.produtos_outros.push({field:b.nome,id:b.id})})),a.rests++,a.$broadcast("carregar_occur",a.rests)}),a.licencas=[{name:"Licen"+String.fromCharCode(231)+"a ambiental federal",value:"1"},{name:"Licen"+String.fromCharCode(231)+"a ambiental estadual",value:"2"},{name:"Licen"+String.fromCharCode(231)+"a ambiental municipal",value:"3"}],a.unidades=[{name:"Metro C"+String.fromCharCode(250)+"bico (m3)",value:"m3"},{name:"Litro (L)",value:"L"},{name:"Tonelada (T)",value:"T"},{name:"Quilograma (Kg)",value:"Kg"}],a.$on("carregar_occur",function(c,d){"carregar"==a.acao&&9==d?b.query({query:"carregar_ocorrencia",ocorrencia:a.nro_ocorrencia},function(b){b[0]?(a.oleo="S"==b[0].ocorrencia_oleo?!0:!1,a.validador&&(a.validador.validado="S"==b[0].validado?!0:!1),a.$broadcast("carregar_localizacao",b),a.$broadcast("carregar_datas",b),a.$broadcast("carregar_origem",b),a.$broadcast("carregar_evento",b),a.$broadcast("carregar_produtos",b),a.$broadcast("carregar_detalhes",b),a.$broadcast("carregar_ambientes",b),a.$broadcast("carregar_empresa",b),a.$broadcast("carregar_instituicao",b),a.$broadcast("carregar_acoes",b),a.$broadcast("carregar_gerais",b),a.$broadcast("carregar_comunicante",b),a.$broadcast("carregar_fonte",b)):(a.nro_ocorrencia="",alert("Ocorrencia não encontrada em nossos registros"))}):"deletar"==a.acao&&b.query({query:"deletar_ocorrencia"},function(){})}),a.submit=function(){if("criar"==a.acao){var c={};c.nro_ocorrencia=a.nro_ocorrencia,c.oleo=a.oleo,c.tipo_comunicante=a.tipo_comunicante,c.acoes=a.acoes,c.ambiente=a.ambiente,c.ambiente.ambientes=[],angular.forEach(a.ambientes,function(a){a.value&&c.ambiente.ambientes.push(a.id)}),c.arquivo=a.arquivo,c.comunicante=a.comunicante,c.datas=a.datas,c.detalhes=a.detalhes,c.empresa=a.empresa,c.evento=a.evento,c.evento.eventos=[],angular.forEach(a.eventos,function(a){a.value&&c.evento.eventos.push(a.id)}),c.gerais=a.gerais,c.instituicao=a.instituicao,c.instituicao.instituicoes=[],angular.forEach(a.instituicoes,function(a){a.value&&c.instituicao.instituicoes.push(a.id)}),c.localizacao=a.localizacao,c.origem=a.origem,c.origem.origens=[],angular.forEach(a.origens,function(a){a.value&&c.origem.origens.push(a.id)}),c.produtos=a.produtos,a.usuario&&(c.fonte=a.fonte,c.fonte.fontes=[],angular.forEach(a.fontes,function(a){a.value&&c.fonte.fontes.push(a.id)}));var d=[];if(c.localizacao.lat||d.push("1. Preencha o campo de Latitude"),c.localizacao.lng||d.push("1. Preencha o campo de Longitude"),c.localizacao.lat&&c.localizacao.lng&&(c.acidente=a.mapa.acidente.toGeoJSON()),c.datas.semIncidente||(e=c.datas,e.diaIncidente||d.push('2. Preencha o campo "Data do Incidente"'),e.incPeriodo||d.push('2. Preencha o campo "Per'+String.fromCharCode(237)+'odo do Incidente"')),c.datas.semObservacao||(e=c.datas,e.diaObservacao||d.push('2. Preencha o campo "Data de Observa'+String.fromCharCode(231)+String.fromCharCode(227)+'o"'),e.obsPeriodo||d.push('2. Preencha o campo "Per'+String.fromCharCode(237)+"odo de Observa"+String.fromCharCode(231)+String.fromCharCode(227)+'o"')),a.oleo&&(c.origem.semOleoOrigem||c.origem.navio&&""!=c.origem.navio||c.origem.instalacao&&""!=c.origem.instalacao||d.push('3. Preencha o campo "Origem do acidente - Identificacao do Navio')),c.origem.semOrigem||c.origem.origens[0]||d.push('3. Preencha o campo "Origem do acidente"'),c.evento.semEvento||c.evento.eventos[0]||d.push('4. Preencha o campo "Tipo de Evento"'),!(c.produtos.semProduto||c.produtos.naoClassificado||c.produtos.naoAplica||c.produtos.naoEspecificado)&&a.oleo)if(c.produtos.semCondicoes){if(!c.produtos.semProduto);}else c.produtos.produtos_onu[0]||c.produtos.produtos_outros[0]||d.push('5. Preencha o campo "Tipos de Produtos"');if(c.detalhes.semDetalhe||c.detalhes.causa&&""!=c.detalhes.causa||d.push('6. Preencha o campo "Detalhes do Acidente"'),c.ambiente.semAmbientes||c.ambiente.ambientes[0]||d.push('7. Preencha o campo "Ambientes atingidos"'),c.empresa.semEmpresa||c.empresa.nome&&""!=c.empresa.nome||d.push("8. Preencha o Campo Nome em Identifica"+String.fromCharCode(231)+String.fromCharCode(227)+"o da Empresa/Respons"+String.fromCharCode(225)+"vel"),c.instituicao.semInstituicao||c.instituicao.instituicoes[0]||d.push("9. Preencha o campo de institui"+String.fromCharCode(231)+String.fromCharCode(227)+"o/empresa atuando no local"),!c.acoes.semAcoes){var e=c.acoes;""==e.plano&&0==e.planoIndividual&&(e.outrasProvidencias?(void 0==e.outrasProvidenciasText||""==e.outrasProvidenciasText)&&d.push('10. O campo "Outras providencias a saber" deve ser preenchido'):d.push('10. Preencha o campo "A'+String.fromCharCode(231)+String.fromCharCode(245)+'es iniciais"'))}a.error=d;var f=JSON.stringify(c);a.error[0]||b.query({query:"criar_ocorrencia",formulario:f},function(b){a.files&&a.upload(a.files),b[0]?a.recarregarSistema():alert("Erro interno de banco. Por favor, procurar o administrador do sistema.")})}else if("carregar"==a.acao){console.log(a.acao);var g={};g.nro_ocorrencia=a.nro_ocorrencia,g.oleo=a.oleo,g.tipo_comunicante=a.tipo_comunicante,a.validador&&(g.validador={},g.validador.validado=a.validador.validado),g.localizacao=a.localizacao,g.acidente=a.mapa.acidente.toGeoJSON(),g.datas=a.datas,g.origem=a.origem,g.origem.origens=[],angular.forEach(a.origens,function(a){a.value&&g.origem.origens.push(a.id)}),g.evento=a.evento,g.evento.eventos=[],angular.forEach(a.eventos,function(a){a.value&&g.evento.eventos.push(a.id)}),g.produtos=a.produtos,g.detalhes=a.detalhes,g.ambiente=a.ambiente,g.ambiente.ambientes=[],angular.forEach(a.ambientes,function(a){a.value&&g.ambiente.ambientes.push(a.id)}),g.empresa=a.empresa,g.instituicao=a.instituicao,g.instituicao.instituicoes=[],angular.forEach(a.instituicoes,function(a){a.value&&g.instituicao.instituicoes.push(a.id)}),g.acoes=a.acoes,g.gerais=a.gerais,g.comunicante=a.comunicante,a.usuario&&(g.fonte=a.fonte,g.fonte.fontes=[],angular.forEach(a.fontes,function(a){a.value&&g.fonte.fontes.push(a.id)})),g.arquivo=a.arquivo;var d=[];if(g.localizacao.lat||d.push("1. Preencha o campo de Latitude"),g.localizacao.lng||d.push("1. Preencha o campo de Longitude"),g.localizacao.lat&&g.localizacao.lng&&(g.acidente=a.mapa.acidente.toGeoJSON()),g.datas.semIncidente||(e=g.datas,e.diaIncidente||d.push('2. Preencha o campo "Data do Incidente"'),e.incPeriodo||d.push('2. Preencha o campo "Período do Incidente"')),g.datas.semObservacao||(e=g.datas,e.diaObservacao||d.push('2. Preencha o campo "Data de Observaçao"'),e.obsPeriodo||d.push('2. Preencha o campo "Período de Observacao"')),g.origem.semOrigem||g.origem.origens[0]||d.push("3. Preencha o campo de Origem do acidente"),a.oleo&&(g.origem.semOleoOrigem||g.origem.navio&&""!=g.origem.navio||g.origem.instalacao&&""!=g.origem.instalacao||d.push('3. Preencha o campo "Origem do acidente - Identificacao do Navio')),g.evento.semEvento||g.evento.eventos[0]||d.push("4. Preencha o campo tipo de evento"),!(g.produtos.semProduto||g.produtos.naoClassificado||g.produtos.naoAplica||g.produtos.naoEspecificado)&&a.oleo)if(g.produtos.semCondicoes){if(!g.produtos.semProduto);}else g.produtos.produtos_onu[0]||g.produtos.produtos_outros[0]||d.push('5. Preencha o campo "Tipos de Produtos"');if(g.detalhes.semDetalhe||g.detalhes.causa&&""!=g.detalhes.causa||d.push('6. Preencha o campo "Detalhes do Acidente"'),g.ambiente.semAmbientes||g.ambiente.ambientes[0]||d.push("7. Preencha o campo de ambientes atingidos"),g.empresa.semEmpresa||g.empresa.nome&&""!=g.empresa.nome||d.push("8. Preencha o Campo Nome em Identificação da Empresa/Responsavel"),g.instituicao.semInstituicao||g.instituicao.instituicoes[0]||d.push("9. Preencha o campo de instituicao/empresa atuando no local"),!g.acoes.semAcoes){var e=g.acoes;""==e.plano&&0==e.planoIndividual&&(e.outrasProvidencias?(void 0==e.outrasProvidenciasText||""==e.outrasProvidenciasText)&&d.push('10. O campo "Outras providencias a saber" deve ser preenchido'):d.push("10. Preencha acões iniciais"))}a.error=d;var h=JSON.stringify(g);a.error[0]||b.query({query:"atualizar_ocorrencia",formulario:h},function(b){a.files&&a.upload(a.files),b[0]?a.recarregarSistema():alert("Erro interno de banco. Por favor, procurar o administrador do sistema.")})}},a.close=function(){$window.close()},a.recarregarSistema=function(){d.url("/html?id="+a.nro_ocorrencia)}}]),angular.module("estatisticasApp").directive("localizacao",["RestApi",function(a){return{templateUrl:"views/accordions/localizacao.html",restrict:"E",controller:["$scope",function(b){b.localizacao.subPanel=b.oleo?"(Itens IV do Anexo II do Decreto n"+String.fromCharCode(176)+" 4.136 de 20 de fevereiro de 2002)":"",b.localizacao.lat,b.localizacao.lng,b.localizacao.oceano=!1,b.localizacao.bacia,b.localizacao.uf,b.localizacao.municipio,b.localizacao.endereco,$("#lat").add("#lng").mask("S99"+String.fromCharCode(176)+"99'99.99999999999",{translation:{S:{pattern:/^-/,optional:!0}}}),b.localizacao.carregarMunicipios=function(c){a.query({query:"municipios",uf:c},function(a){b.municipios=[],angular.forEach(a,function(a){b.municipios.push({name:a.nome,value:a.cod_ibge})})})},b.$on("carregar_localizacao",function(a,c){b.localizacao.subPanel=b.oleo?"(Itens IV do Anexo II do Decreto n"+String.fromCharCode(176)+" 4.136 de 20 de fevereiro de 2002)":"",b.localizacao.lat=c[0].coordinate.split(" ")[0],b.localizacao.lng=c[0].coordinate.split(" ")[1],b.localizacao.oceano=c[0].id_bacia_sedimentar?!0:!1,b.localizacao.bacia=c[0].id_bacia_sedimentar,b.localizacao.uf=c[0].id_uf,b.localizacao.carregarMunicipios(b.localizacao.uf),b.localizacao.municipio=c[0].id_municipio,b.localizacao.endereco=c[0].endereco_ocorrencia,b.$broadcast("carregar_mapa",c)})}]}}]),angular.module("estatisticasApp").directive("datas",function(){return{templateUrl:"views/accordions/datas.html",restrict:"E",controller:["$scope",function(a){a.datas.subPanel=a.oleo?"(Itens II e III do Anexo II do Decreto n"+String.fromCharCode(176)+" 4.136 de 20 de fevereiro de 2002)":"",a.datas.diaObservacao="",a.datas.horaObservacao="",a.datas.obsSemana=0,a.datas.obsPeriodo="",a.datas.semObservacao=!1,a.datas.diaIncidente="",a.datas.horaIncidente="",a.datas.incSemana=0,a.datas.incPeriodo="",a.datas.semIncidente=!1,a.updateSemana=function(b,c){var d=a.datas[b].split("/");a.datas[c]=new Date(d[2],d[1]-1,d[0]).getDay()+1},a.getPeriodoObs=function(b){var c=b.split(":");c[0]=parseInt(c[0]),c[0]>=0&&c[0]<6?a.datas.obsPeriodo="A":c[0]>=6&&c[0]<12?a.datas.obsPeriodo="M":c[0]>=12&&c[0]<18?a.datas.obsPeriodo="V":c[0]>=18&&c[0]<=23&&(a.datas.obsPeriodo="N")},a.getPeriodoInc=function(b){var c=b.split(":");c[0]=parseInt(c[0]),c[0]>=0&&c[0]<6?a.datas.incPeriodo="A":c[0]>=6&&c[0]<12?a.datas.incPeriodo="M":c[0]>=12&&c[0]<18?a.datas.incPeriodo="V":c[0]>=18&&c[0]<=23&&(a.datas.incPeriodo="N")},a.$on("carregar_datas",function(b,c){a.datas.subPanel=a.oleo?"(Itens II e III do Anexo II do Decreto n"+String.fromCharCode(176)+" 4.136 de 20 de fevereiro de 2002)":"";var d;null!=c[0].dt_primeira_obs?(d=c[0].dt_primeira_obs.split("-"),a.datas.diaObservacao=d[2]+"/"+d[1]+"/"+d[0],a.updateSemana("diaObservacao","obsSemana"),a.datas.horaObservacao=c[0].hr_primeira_obs,a.datas.obsPeriodo=c[0].periodo_primeira_obs,a.datas.semObservacao=!1):a.datas.semObservacao=!0,null!=c[0].dt_ocorrencia?(d=c[0].dt_ocorrencia.split("-"),a.datas.diaIncidente=d[2]+"/"+d[1]+"/"+d[0],a.updateSemana("diaIncidente","incSemana"),a.datas.horaIncidente=c[0].hr_ocorrencia,a.datas.incPeriodo=c[0].periodo_ocorrencia,a.datas.feriado=c[0].dt_ocorrencia_feriado,a.datas.semIncidente=!1):a.datas.semIncidente=!0})}]}}),angular.module("estatisticasApp").directive("origem",function(){return{templateUrl:"views/accordions/origem.html",restrict:"E",controller:["$scope",function(a){a.origem.subPanel=a.oleo?"(Itens I do Anexo II do Decreto n"+String.fromCharCode(176)+" 4.136 de 20 de fevereiro de 2002)":"",a.origem.complementar="",a.origem.semOrigem=!1,a.origem.semOleoOrigem=!1,a.$on("carregar_origem",function(b,c){a.origem.subPanel=a.oleo?"(Itens I do Anexo II do Decreto n"+String.fromCharCode(176)+" 4.136 de 20 de fevereiro de 2002)":"";var d=c[0].origem.replace(/[{}]/g,"").split(",");""!=d[0]?(angular.forEach(a.origens,function(a){d.indexOf(a.id)>=0&&(a.value=!0)}),a.origem.complementar=c[0].des_complemento_tipo_localizaca):a.origem.semOrigem=!0,a.oleo&&(null!=c[0].des_navio||null!=c[0].des_instalacao?(a.origem.navio=c[0].des_navio,a.origem.instalacao=c[0].des_instalacao):a.origem.semOleoOrigem=!0)})}]}}),angular.module("estatisticasApp").directive("evento",function(){return{templateUrl:"views/accordions/evento.html",restrict:"E",controller:["$scope",function(a){a.evento.complementar="",a.evento.semEvento=!1,a.$on("carregar_evento",function(b,c){var d=c[0].evento.replace(/[{}]/g,"").split(",");""!=d[0]?(angular.forEach(a.eventos,function(a){d.indexOf(a.id)>=0&&(a.value=!0)}),a.evento.complementar=c[0].des_complemento_tipo_evento):a.evento.semEvento=!0})}]}}),angular.module("estatisticasApp").directive("produtos",["$compile","RestApi",function(a,b){return{templateUrl:"views/accordions/produtos.html",restrict:"E",controller:["$scope",function(c){c.lastEle=1,c.valueRows=[],c.produtos.novo_onu=!0,c.produtos.produtos_onu=[],c.lastEleNaoOnu=1001,c.valueRowsNaoOnu=[],c.produtos.novo_nao_onu=!0,c.produtos.produtos_outros=[],$("#volume").mask("000000000.9999999999",{reverse:!0}),$("#qtdOnu").mask("0000000000000000000000.09",{reverse:!0}),$("#qtdNaoOnu").mask("0000000000000000000000.09",{reverse:!0}),c.produtos.createMask=function(a){var b="#"+a;$(b).mask("00000.09",{reverse:!0})},c.produtos.subPanel=c.oleo?"(Itens V do Anexo II do Decreto n"+String.fromCharCode(176)+" 4.136 de 20 de fevereiro de 2002)":"",c.$on("carregar_produtos",function(a,d){c.produtos.subPanel=c.oleo?"(Itens V do Anexo II do Decreto n"+String.fromCharCode(176)+" 4.136 de 20 de fevereiro de 2002)":"",b.query({query:"produtos_cadastrados",id:d[0].id_ocorrencia},function(a){a&&angular.forEach(a,function(a){var b={};a.id_produto_onu?(b={id:a.id_produto_onu,qtd:a.quantidade,uni:a.unidade_medida,field:a.nome_onu+" - "+a.num_onu+" - "+a.classe_risco},c.produtos.produtos_onu.push(b)):(b={id:a.id_produto_outro,qtd:a.quantidade,uni:a.unidade_medida,field:a.nome_outro},c.produtos.produtos_outros.push(b))})}),"f"==d[0].produto_perigoso&&"f"==d[0].produto_nao_se_aplica&&"f"==d[0].produto_nao_especificado&&0==c.produtos.produtos_onu.length&&0==c.produtos.produtos_outros.length?c.produtos.semProduto=!0:(c.produtos.naoClassificado="t"==d[0].produto_perigoso?!0:!1,c.produtos.naoAplica="t"==d[0].produto_nao_se_aplica?!0:!1,c.produtos.naoEspecificado="t"==d[0].produto_nao_especificado?!0:!1),d[0].tipo_substancia||d[0].volume_estimado?(c.produtos.tipo_substancia=d[0].tipo_substancia,c.produtos.valor_substancia=d[0].volume_estimado):c.produtos.semCondicoes=!0}),c.addRowOnu=function(){c.valueRows.push(++c.lastEle),c.produtos.novo_onu=!1},c.deleteData=function(a){var b=c.produtos.produtos_onu.indexOf(a);b>-1?c.produtos.produtos_onu.splice(b,1):(c.produtos.substanciaOnu="",c.produtos.quantidadeOnu="",c.produtos.unidadeOnu="",c.valueRows=[],c.produtos.novo_onu=!0)},c.saveData=function(){var a={id:c.produtos.substanciaOnu.id,qtd:c.produtos.quantidadeOnu,uni:c.produtos.unidadeOnu,field:c.produtos.substanciaOnu.field};c.produtos.produtos_onu.push(a),c.produtos.substanciaOnu="",c.produtos.quantidadeOnu="",c.produtos.unidadeOnu="",c.valueRows=[],c.produtos.novo_onu=!0},c.addRowNaoOnu=function(){c.valueRowsNaoOnu.push(++c.lastEleNaoOnu),c.produtos.novo_nao_onu=!1},c.deleteDataNaoOnu=function(a){var b=c.produtos.produtos_outros.indexOf(a);b>-1?c.produtos.produtos_outros.splice(b,1):(c.produtos.substanciaOutro="",c.produtos.quantidadeOutro="",c.produtos.unidadeOutro="",c.valueRowsNaoOnu=[],c.produtos.novo_nao_onu=!0)},c.saveDataNaoOnu=function(){var a={id:c.produtos.substanciaOutro.id,qtd:c.produtos.quantidadeOutro,uni:c.produtos.unidadeOutro,field:c.produtos.substanciaOutro.field};c.produtos.produtos_outros.push(a),c.produtos.substanciaOutro="",c.produtos.quantidadeOutro="",c.produtos.unidadeOutro="",c.valueRowsNaoOnu=[],c.produtos.novo_nao_onu=!0},c.popover=function(){$('[data-toggle="popover"]').popover({html:!0}),$("#addTipo").popover({html:!0,content:function(){return $("#popoverContent").html()}}).click(function(){a($(".popover.in").contents())(c)})},c.validate=function(a){var b=["SELECT","select","*","FROM","from","%","DROP","drop",""],c=0;return angular.forEach(b,function(b){a!=b&&a||c++,angular.forEach(a,function(a){a==b&&c++})}),0==c?!0:!1},c.addTipo=function(a){var d=c.validate(a);d&&b.query({query:"adicionar_tipo",tipo_produto:a},function(a){a&&(c.produtos_outros=[],angular.forEach(a,function(a){c.produtos_outros.push({field:a.nome,id:a.id})}))}),$("#addTipo").popover("hide")}}]}}]),angular.module("estatisticasApp").directive("detalhes",function(){return{templateUrl:"views/accordions/detalhes.html",restrict:"E",controller:["$scope",function(a){a.detalhes.subPanel=a.oleo?"(Itens VI e VII do Anexo II do Decreto n"+String.fromCharCode(176)+" 4.136 de 20 de fevereiro de 2002)":"",a.detalhes.semDetalhe=!1,a.detalhes.causa="",a.detalhes.situacao,a.$on("carregar_detalhes",function(b,c){a.detalhes.subPanel=a.oleo?"(Itens VI e VII do Anexo II do Decreto n"+String.fromCharCode(176)+" 4.136 de 20 de fevereiro de 2002)":"",null!=c[0].des_causa_provavel&&""!=c[0].des_causa_provavel?a.detalhes.causa=c[0].des_causa_provavel:a.detalhes.semDetalhe=!0,a.oleo&&(a.detalhes.situacao=c[0].situacao_atual_descarga)})}]}}),angular.module("estatisticasApp").directive("ambientes",function(){return{templateUrl:"views/accordions/ambientes.html",restrict:"E",controller:["$scope",function(a){a.ambiente.complementar="",a.ambiente.semAmbientes=!1,a.$on("carregar_ambientes",function(b,c){var d=c[0].ambiente.replace(/[{}]/g,"").split(",");""!=d[0]?(angular.forEach(a.ambientes,function(a){d.indexOf(a.id)>=0&&(a.value=!0)}),a.ambiente.complementar=c[0].des_complemento_tipo_dano_ident):a.ambiente.semAmbientes=!0})}]}}),angular.module("estatisticasApp").directive("empresa",function(){return{templateUrl:"views/accordions/empresa.html",restrict:"E",controller:["$scope",function(a){a.empresa.nome="",a.empresa.cadastro="",a.empresa.licencaAmbiental="0",a.empresa.semEmpresa=!1,a.$on("carregar_empresa",function(b,c){null!=c[0].nome_responsavel?(a.empresa.nome=c[0].nome_responsavel,a.empresa.cadastro=c[0].cpf_cnpj_responsavel,a.empresa.licencaAmbiental=c[0].licenca_responsavel):a.empresa.semEmpresa=!0})}]}}),angular.module("estatisticasApp").directive("instituicao",function(){return{templateUrl:"views/accordions/instituicao.html",restrict:"E",controller:["$scope",function(a){a.instituicao.semInstituicao=!1,a.instituicao.complementar="",a.$on("carregar_instituicao",function(b,c){var d=c[0].instituicao.replace(/[{}]/g,"").split(",");""!=d[0]?(angular.forEach(a.instituicoes,function(a){d.indexOf(a.id)>=0&&(a.value=!0)}),a.instituicao.complementar=c[0].des_complemento_instituicao_atu,a.instituicao.responsavel=c[0].nome_instituicao_atuando,a.instituicao.telefone=c[0].telefone_instituicao_atuando):a.instituicao.semInstituicao=!0})}]}}),angular.module("estatisticasApp").directive("acoes",function(){return{templateUrl:"views/accordions/acoes.html",restrict:"E",controller:["$scope",function(a){a.acoes.subPanel=a.oleo?"(Itens VIII do Anexo II do Decreto n"+String.fromCharCode(176)+" 4.136 de 20 de fevereiro de 2002)":"",a.acoes.plano="",a.acoes.planoIndividual=!1,a.acoes.outrasProvidencias=!1,a.acoes.semAcoes=!1,a.$on("carregar_acoes",function(b,c){a.acoes.subPanel=a.oleo?"(Itens VIII do Anexo II do Decreto n"+String.fromCharCode(176)+" 4.136 de 20 de fevereiro de 2002)":"","S"==c[0].plano_emergencia||"N"==c[0].plano_emergencia||"I"==c[0].plano_emergencia?(a.acoes.plano=c[0].plano_emergencia,a.acoes.planoIndividual="S"==c[0].plano_emergencia_acionado?!0:!1,a.acoes.outrasProvidencias="S"==c[0].iniciados_outras_providencias?!0:!1,a.acoes.outrasProvidenciasText=c[0].des_outras_providencias):a.acoes.semAcoes=!0})}]}}),angular.module("estatisticasApp").directive("gerais",function(){return{templateUrl:"views/accordions/gerais.html",restrict:"E",controller:["$scope",function(a){a.gerais.subPanel=a.oleo?"(Itens IX do Anexo II do Decreto n"+String.fromCharCode(176)+" 4.136 de 20 de fevereiro de 2002)":"",a.gerais.text="",a.$on("carregar_gerais",function(b,c){a.gerais.subPanel=a.oleo?"(Itens IX do Anexo II do Decreto n"+String.fromCharCode(176)+" 4.136 de 20 de fevereiro de 2002)":"",a.gerais.text=c[0].des_obs})}]}}),angular.module("estatisticasApp").directive("comunicante",function(){return{templateUrl:"views/accordions/comunicante.html",restrict:"E",controller:["$scope",function(a){
a.comunicante.subPanel=a.oleo?"(Itens X do Anexo II do Decreto n"+String.fromCharCode(176)+" 4.136 de 20 de fevereiro de 2002)":"",a.comunicante.nome=a.usuario?a.usuario:"",a.comunicante.empresa="",a.comunicante.funcao="",a.comunicante.telefone="",a.comunicante.email=a.email?a.email:"",a.$on("carregar_origem",function(b,c){a.comunicante.subPanel=a.oleo?"(Itens X do Anexo II do Decreto n"+String.fromCharCode(176)+" 4.136 de 20 de fevereiro de 2002)":"",a.comunicante.nome=c[0].nome_comunicante,a.comunicante.empresa=c[0].des_instituicao_empresa,a.comunicante.funcao=c[0].des_funcao_comunicante,a.comunicante.telefone=c[0].telefone_contato,a.comunicante.email=c[0].email_comunicante})}]}}),angular.module("estatisticasApp").directive("arquivos",function(){return{templateUrl:"views/accordions/arquivos.html",restrict:"E",controller:["$rootScope","$scope","Upload",function(a,b,c){b.showFileName=function(a){b.file=a,a&&a.length&&(b.name=a[0].name)},b.upload=function(d){if(d&&d.length){b.file=d;for(var e=0;e<d.length;e++){var f=d[e];b.name=d[e].name,f.ocurr=b.nro_ocorrencia,c.upload({url:"//"+document.location.hostname+document.location.pathname+"../upload.php",data:b.nro_ocorrencia,file:f}).success(function(b,c,d,e){console.log("Arquivo "+e.file.name+" upado com sucesso. Retorno: "+b),a.arquivoSuccess=b})}}},b.limpArquivo=function(){b.file=null,b.files=null}}]}}),angular.module("estatisticasApp").directive("calendar",function(){return{require:"ngModel",restrict:"EA",link:function(a,b){var c=new Date,d=c.getDate();10>d&&(d="0"+d.toString());var e=c.getMonth()+1;10>e&&(e="0"+e.toString());var f=c.getFullYear(),g=d+"/"+e+"/"+f,h=d+"/"+e+"/"+(f-1);$(b).datepicker({format:"dd/mm/yyyy",autoclose:!0,language:"pt-BR",startDate:h,endDate:g})}}}),angular.module("estatisticasApp").directive("map",["RestApi",function(a){return{template:'<div id="map" class="map"></div>',restrict:"AE",controller:["$scope","$cookies","$rootScope","$timeout","$http",function(b,c,d,e,f){b.mapa.acidente=null,L.Icon.Default.imagePath="images",b.map=L.map("map").setView([-12,-53],3);var g=(L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}).addTo(b.map),new L.FeatureGroup);b.map.addLayer(g);var h=new L.Control.Draw({edit:{featureGroup:g},draw:{polygon:!1,polyline:!1,rectangle:!1,circle:!1,marker:!0}});b.map.addControl(h),b.mapa.getUf=function(c,d){f.get("//nominatim.openstreetmap.org/reverse?format=json&lat="+c+"&lon="+d).success(function(c){if(c.address){if(c.address.state){var d=$.grep(b.ufs,function(a){return a.fullname==c.address.state});d[0]&&(b.localizacao.uf=d[0].value,b.localizacao.carregarMunicipios(b.localizacao.uf))}else b.localizacao.uf="";c.address.city?(d=a.query({query:"municipio_id",municipio_nome:c.address.city},function(a){b.$broadcast("atualizar_municipio",a)}),b.$on("atualizar_municipio",function(a,c){c[0]&&(b.localizacao.municipio=c[0].cod_ibge)})):b.localizacao.municipio="";var e="";c.address.road&&(e=e+" "+c.address.road+","),c.address.suburb&&(e=e+" "+c.address.suburb+","),b.localizacao.endereco=e.substring(0,e.length-1)}})},b.map.on("draw:created",function(a){var c=(a.layerType,a.layer),d=c.toGeoJSON();b.map.hasLayer(b.mapa.acidente)&&b.map.removeLayer(b.mapa.acidente),b.mapa.acidente=new L.Marker(d.geometry.coordinates.reverse()),b.map.addLayer(b.mapa.acidente),b.localizacao.lat=d.geometry.coordinates[0],b.localizacao.lng=d.geometry.coordinates[1],b.localizacao.lat=b.mapa.converterDMS(d.geometry.coordinates[0]),b.localizacao.lng=b.mapa.converterDMS(d.geometry.coordinates[1]),b.mapa.getUf(d.geometry.coordinates[0],d.geometry.coordinates[1]),b.$apply()}),b.mapa.converterDMS=function(a){var b=parseInt(0|a),c=Math.abs(a-b),d=60*c|0,e=3600*c-60*d;return b+String.fromCharCode(176)+d+"'"+e.toFixed(3)},b.mapa.converterDD=function(a){var b=0/0,c=0/0,d=0/0;a&&(b=a.split(String.fromCharCode(176))[0],c=a.split(String.fromCharCode(176))[1]?a.split(String.fromCharCode(176))[1].split("'")[0]:0,d=a.split(String.fromCharCode(176))[1]&&a.split(String.fromCharCode(176))[1].split("'")[1]?a.split(String.fromCharCode(176))[1].split("'")[1].split('"')[0]:0);var e=0/0;return $.isNumeric(b)&&$.isNumeric(c)&&$.isNumeric(d)&&(e=Math.sign(b)*(Math.abs(b)+c/60+d/3600)),e},b.mapa.validarMarcador=function(b){return a.query({query:"verificar_marcador",lat:b.getLatLng().lat,lng:b.getLatLng().lng},function(a){angular.forEach(a,function(a){ret="t"==a.intersects?1:0})}),ret},b.mapa.mudarMarcador=function(){b._timeout&&e.cancel(b._timeout),b._timeout=e(function(){var a=b.mapa.converterDD(b.localizacao.lat),c=b.mapa.converterDD(b.localizacao.lng);if(a&&c){var d=new L.Marker([a,c]);b.map.hasLayer(b.mapa.acidente)&&b.map.removeLayer(b.mapa.acidente),b.mapa.acidente=d,b.map.addLayer(b.mapa.acidente)}b._timeout=null},1e3)},b.$on("carregar_mapa",function(a,c){b.mapa.acidente=new L.Marker(JSON.parse(c[0].coordinate_json).coordinates.reverse()),b.map.addLayer(b.mapa.acidente)})}]}}]),angular.module("estatisticasApp").directive("pdf",function(){return{templateUrl:"views/acidente.html",restrict:"E",controller:["$scope",function(){console.log("isOn")}]}}),angular.module("estatisticasApp").controller("PdfCtrl",["$scope","RestApi","$routeParams",function(a,b,c){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"],a.licencas=[{name:"Licenca ambiental federal",value:"1"},{name:"Licenca ambiental estadual",value:"2"},{name:"Licenca ambiental municipal",value:"3"}],a.carregarMunicipios=function(c){b.query({query:"municipios",uf:c},function(b){a.municipios=[],angular.forEach(b,function(b){a.municipios.push({name:b.nome,value:b.cod_ibge})})})},b.query({query:"ufs"},function(b){a.ufs=[],angular.forEach(b,function(b){a.ufs.push({name:b.sigla,value:b.id_uf})})}),b.query({query:"bacias"},function(b){a.bacias=[],angular.forEach(b,function(b){a.bacias.push({name:b.nome,value:b.id_bacia_sedimentar})})}),b.query({query:"origens"},function(b){a.origens=[],angular.forEach(b,function(b){a.origens.push({name:b.des_tipo_localizacao,id:b.id_tipo_localizacao,value:!1})})}),b.query({query:"eventos"},function(b){a.eventos=[],angular.forEach(b,function(b){a.eventos.push({name:b.nome,id:b.id_tipo_evento,value:!1})})}),b.query({query:"ambientes"},function(b){a.ambientes=[],angular.forEach(b,function(b){a.ambientes.push({name:b.nome,id:b.id_tipo_dano_identificado,value:!1})})}),b.query({query:"instituicoes"},function(b){a.instituicoes=[],angular.forEach(b,function(b){a.instituicoes.push({name:b.nome,id:b.id_instituicao_atuando_local,value:!1})})}),b.query({query:"fontes"},function(b){a.fontes=[],angular.forEach(b,function(b){a.fontes.push({name:b.nome,id:b.id_tipo_fonte_informacao,value:!1})})}),a.nro_ocorrencia=c.id,b.query({query:"carregar_ocorrencia",ocorrencia:a.nro_ocorrencia},function(c){a.oleo="S"==c[0].ocorrencia_oleo?!0:!1,a.acoes={},a.acoes.plano="",a.acoes.planoIndividual="",a.acoes.outrasProvidencias=!1,a.acoes.semAcoes=!1,"S"==c[0].plano_emergencia||"N"==c[0].plano_emergencia||"I"==c[0].plano_emergencia?(a.acoes.plano=c[0].plano_emergencia,a.acoes.planoIndividual="S"==c[0].plano_emergencia_acionado?!0:!1,a.acoes.outrasProvidencias="S"==c[0].iniciados_outras_providencias?!0:!1,a.acoes.outrasProvidenciasText=c[0].des_outras_providencias):a.acoes.semAcoes=!0,a.ambiente={},a.ambiente.complementar="",a.ambiente.semAmbientes=!1;var d=c[0].ambiente.replace(/[{}]/g,"").split(",");""!=d[0]?(angular.forEach(a.ambientes,function(a){d.indexOf(a.id)>=0&&(a.value=!0)}),a.ambiente.complementar=c[0].des_complemento_tipo_dano_ident,a.ambiente.complementarVal=""==a.ambiente.complementar?!1:!0):a.ambiente.semAmbientes=!0,a.comunicante={},a.comunicante.nome=c[0].nome_comunicante,a.comunicante.empresa=c[0].des_instituicao_empresa,a.comunicante.funcao=c[0].des_funcao_comunicante,a.comunicante.telefone=c[0].telefone_contato,a.comunicante.email=c[0].email_comunicante,(""==a.comunicante.nome||null==a.comunicante.nome)&&(a.comunicante.nome="****SISTEMA: VALOR NAO INFORMADO!****"),(""==a.comunicante.empresa||null==a.comunicante.empresa)&&(a.comunicante.empresa="****SISTEMA: VALOR NAO INFORMADO!****"),(""==a.comunicante.telefone||null==a.comunicante.telefone)&&(a.comunicante.telefone="****SISTEMA: VALOR NAO INFORMADO!****"),(""==a.comunicante.email||null==a.comunicante.email)&&(a.comunicante.email="****SISTEMA: VALOR NAO INFORMADO!****"),a.datas={},a.datas.diaObservacao,a.datas.horaObservacao,a.datas.obsSemana=0,a.datas.obsPeriodo,a.datas.semObservacao=!1,a.datas.diaIncidente,a.datas.horaIncidente,a.datas.incSemana=0,a.datas.incPeriodo,a.datas.semIncidente=!1,a.updateSemana=function(b,c){var d=a.datas[b].split("/");a.datas[c]=new Date(d[2],d[1]-1,d[0]).getDay()+1};var d;null!=c[0].dt_primeira_obs?(d=c[0].dt_primeira_obs.split("-"),a.datas.diaObservacao=d[2]+"/"+d[1]+"/"+d[0],a.updateSemana("diaObservacao","obsSemana"),a.datas.horaObservacao=c[0].hr_primeira_obs,a.datas.obsPeriodo=c[0].periodo_primeira_obs,a.datas.semObservacao=!1):a.datas.semObservacao=!0,null!=c[0].dt_ocorrencia?(d=c[0].dt_ocorrencia.split("-"),a.datas.diaIncidente=d[2]+"/"+d[1]+"/"+d[0],a.updateSemana("diaIncidente","incSemana"),a.datas.horaIncidente=c[0].hr_ocorrencia,a.datas.incPeriodo=c[0].periodo_ocorrencia,a.datas.feriado=c[0].dt_ocorrencia_feriado,a.datas.semIncidente=!1):a.datas.semIncidente=!0,a.detalhes={},a.detalhes.semDetalhe=!1,a.detalhes.causa="",a.detalhes.situacao,null!=c[0].des_causa_provavel?(a.detalhes.causa=c[0].des_causa_provavel,""==a.detalhes.causa?(a.detalhes.causaVal=!1,a.detalhes.semDetalhe=!0):a.detalhes.causaVal=!0):a.detalhes.semDetalhe=!0,a.oleo&&(a.detalhes.situacaoVal=!0,a.detalhes.situacao=c[0].situacao_atual_descarga),a.empresa={},null!=c[0].nome_responsavel?(a.empresa.nome=c[0].nome_responsavel,a.empresa.cadastro=c[0].cpf_cnpj_responsavel,a.empresa.licencaAmbiental=c[0].licenca_responsavel):a.empresa.semEmpresa=!0,a.evento={};var d=c[0].evento.replace(/[{}]/g,"").split(",");""!=d[0]?(angular.forEach(a.eventos,function(a){d.indexOf(a.id)>=0&&(a.value=!0)}),a.evento.complementar=c[0].des_complemento_tipo_evento,a.evento.complementarVal=""==a.evento.complementar?!1:!0):a.evento.semEvento=!0,a.fonte={},a.fonte.complementar="";var d=c[0].fonte.replace(/[{}]/g,"").split(",");""!=d[0]&&(angular.forEach(a.fontes,function(a){d.indexOf(a.id)>=0&&(a.value=!0)}),a.fonte.complementar=c[0].desc_outras_fontes,a.fonte.complementarVal=""==a.fonte.complementar?!1:!0),a.gerais={},a.gerais.text=c[0].des_obs,a.gerais.text=""==a.gerais.text?"****SISTEMA: VALOR NAO INFORMADO!****":a.gerais.text,a.instituicao={},a.instituicao.semInstituicao=!1,a.instituicao.complementar="";var d=c[0].instituicao.replace(/[{}]/g,"").split(",");""!=d[0]?(angular.forEach(a.instituicoes,function(a){d.indexOf(a.id)>=0&&(a.value=!0)}),a.instituicao.complementar=c[0].des_complemento_instituicao_atu,a.instituicao.responsavel=c[0].nome_instituicao_atuando,a.instituicao.telefone=c[0].telefone_instituicao_atuando,a.instituicao.complementarVal=""==a.instituicao.complementar?!1:!0):a.instituicao.semInstituicao=!0,a.localizacao={},a.localizacao.lat=c[0].coordinate.split(" ")[0],a.localizacao.lng=c[0].coordinate.split(" ")[1],a.localizacao.oceano=c[0].id_bacia_sedimentar?!0:!1,a.localizacao.bacia=c[0].id_bacia_sedimentar,a.localizacao.uf=c[0].id_uf,a.carregarMunicipios(a.localizacao.uf),a.localizacao.municipio=c[0].id_municipio,a.localizacao.endereco=c[0].endereco_ocorrencia,a.origem={};var d=c[0].origem.replace(/[{}]/g,"").split(",");""!=d[0]?(angular.forEach(a.origens,function(a){d.indexOf(a.id)>=0&&(a.value=!0)}),a.origem.complementar=c[0].des_complemento_tipo_localizaca,a.origem.complementarVal=""==a.origem.complementar?!1:!0):a.origem.semOrigem=!0,a.oleo&&(null!=c[0].des_navio||null!=c[0].des_instalacao?(a.origem.navio=c[0].des_navio,""==a.origem.navio&&(a.origem.nouv="I"),a.origem.instalacao=c[0].des_instalacao,""==a.origem.instalacao&&(a.origem.nouv="N")):a.origem.semOleoOrigem=!0),a.produtos={},a.produtos.produtos_outros=[],a.produtos.produtos_onu=[],a.getProdutos=function(){b.query({query:"produtos_cadastrados",id:c[0].id_ocorrencia},function(b){b&&(a.produtos.produtos_outros=[],angular.forEach(b,function(b){var c={};b.id_produto_onu?(c={id:b.id_produto_onu,qtd:b.quantidade,uni:b.unidade_medida,field:b.nome_onu+" - "+b.num_onu+" - "+b.classe_risco},a.produtos.produtos_onu.push(c)):(c={id:b.id_produto_outro,qtd:b.quantidade,uni:b.unidade_medida,field:b.nome_outro},a.produtos.produtos_outros.push(c))}))})},a.getProdutos(),a.produtos.naoClassificado="t"==c[0].produto_perigoso?!0:!1,a.produtos.naoAplica="t"==c[0].produto_nao_se_aplica?!0:!1,a.produtos.naoEspecificado="t"==c[0].produto_nao_especificado?!0:!1,c[0].tipo_substancia||c[0].volume_estimado?(a.produtos.tipo_substancia=c[0].tipo_substancia,a.produtos.valor_substancia=c[0].volume_estimado):a.produtos.semCondicoes=!0})}]),angular.module("estatisticasApp").directive("fonte",function(){return{templateUrl:"views/accordions/fonte.html",restrict:"E",controller:["$scope",function(a){a.fonte.complementar="",a.$on("carregar_fonte",function(b,c){var d=c[0].fonte.replace(/[{}]/g,"").split(",");""!=d[0]&&(angular.forEach(a.fontes,function(a){d.indexOf(a.id)>=0&&(a.value=!0)}),a.fonte.complementar=c[0].desc_outras_fontes)})}]}}),angular.module("estatisticasApp").directive("file",function(){return{scope:{file:"="},link:function(a,b){b.bind("change",function(b){var c=b.target.files,d=c[0];a.file=d?d.name:void 0,a.$apply()})}}});